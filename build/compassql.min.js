!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cql=e()}}(function(){var e;return function t(e,n,r){function i(o,u){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!u&&c)return c(o,!0);if(a)return a(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";function r(e){return o({},n.DEFAULT_QUERY_CONFIG,e,{"enum":i(e["enum"])})}function i(e){var t=o({},s.DEFAULT_ENUM_INDEX,e,{binProps:a(e,"bin"),scaleProps:a(e,"scale"),axisProps:a(e,"axis"),legendProps:a(e,"legend")});return t}function a(e,t){return o({},s.DEFAULT_ENUM_INDEX[t+"Props"],e[t+"Props"])}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},u=e("vega-lite/src/channel"),c=e("./property"),s=e("./wildcard");n.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useRawDomain:!0}},propertyPrecedence:c.DEFAULT_PROP_PRECEDENCE.map(c.toKey),"enum":s.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,preferredBinAxis:u.Channel.X,preferredTemporalAxis:u.Channel.X,preferredOrdinalAxis:u.Channel.Y,preferredNominalAxis:u.Channel.Y,preferredFacet:u.Channel.ROW,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7},n.extendConfig=r},{"./property":11,"./wildcard":29,"vega-lite/src/channel":46}],2:[function(e,t,n){"use strict";var r=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();n.AbstractConstraintModel=r},{}],3:[function(e,t,n){"use strict";var r=e("./encoding"),i=e("./spec");n.encoding=r,n.spec=i},{"./encoding":4,"./spec":5}],4:[function(e,t,n){"use strict";function r(e,t,n,r,i,a){for(var o=E.get(e)||[],u=r.getEncodingQueryByIndex(n),c=0,s=o;c<s.length;c++){var l=s[c];if(l.strict()||a[l.name()]){var f=l.satisfy(u,i,r.wildcardIndex.encodings[n],a);if(!f){var d="(enc) "+l.name();return a.verbose&&console.log(d+" failed with "+r.toShorthand()+" for "+t.name),d}}}return null}var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/channel"),u=e("vega-lite/src/scale"),c=e("vega-lite/src/type"),s=e("./base"),l=e("../property"),f=e("../propindex"),d=e("../wildcard"),p=e("../schema"),g=e("../util"),y=e("../query/encoding"),h=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return g.every(this.constraint.properties,function(t){if(l.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return!e[n]||!d.isWildcard(e[n][r])}return!e[t]||!d.isWildcard(e[t])})},t.prototype.satisfy=function(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)},t}(s.AbstractConstraintModel);n.EncodingConstraintModel=h,n.ENCODING_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[l.Property.TYPE,l.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.aggregate||e.type!==c.Type.ORDINAL&&e.type!==c.Type.NOMINAL}},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[l.Property.FIELD,l.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return"*"===e.field==(e.aggregate===a.AggregateOp.COUNT)}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[l.Property.TYPE,l.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||e.type===c.Type.QUANTITATIVE}},{name:"channelSupportsRole",description:"encoding channel should support the role of the field",properties:[l.Property.CHANNEL,l.Property.TYPE,l.Property.BIN,l.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(d.isWildcard(e.channel))return!0;if(!n.has("channel")&&!r.constraintManuallySpecifiedValue)return!0;var i=o.getSupportedRole(e.channel);return y.isDimension(e)?i.dimension:!y.isMeasure(e)||i.measure}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[l.Property.AGGREGATE,l.Property.BIN,l.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){return!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[l.Property.SCALE,l.getEncodingNestedProp("scale","zero"),l.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[l.Property.AGGREGATE,l.Property.AUTOCOUNT,l.Property.TIMEUNIT,l.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){var i=(!d.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!d.isWildcard(e.autoCount)&&e.autoCount?1:0)+(!d.isWildcard(e.bin)&&e.bin?1:0)+(!d.isWildcard(e.timeUnit)&&e.timeUnit?1:0);return i<=1}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[l.Property.TYPE,l.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.timeUnit||e.type===c.Type.TEMPORAL}},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[l.Property.TIMEUNIT,l.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!e.timeUnit||e.type!==c.Type.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(l.SCALE_PROPS,[l.Property.SCALE,l.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.scale,a=y.scaleType(e);if(void 0===a||null===a)return!0;for(var o in i)if("type"!==o&&"name"!==o&&"enum"!==o)if("point"===a){if(!u.scaleTypeSupportProperty("point",o)&&!u.scaleTypeSupportProperty("band",o))return!1}else if(!u.scaleTypeSupportProperty(a,o))return!1}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[l.Property.FIELD,l.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if("*"===e.field)return!0;var i=t.primitiveType(e.field),a=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case p.PrimitiveType.BOOLEAN:case p.PrimitiveType.STRING:return a!==c.Type.QUANTITATIVE&&a!==c.Type.TEMPORAL;case p.PrimitiveType.NUMBER:case p.PrimitiveType.INTEGER:return a!==c.Type.TEMPORAL;case p.PrimitiveType.DATE:return a===c.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[l.Property.FIELD,l.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===c.Type.QUANTITATIVE:t.type(e.field)===e.type)}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[l.Property.CHANNEL,l.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==o.Channel.COLOR||e.type!==c.Type.NOMINAL||t.cardinality(e)<=r.maxCardinalityForCategoricalColor}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[l.Property.CHANNEL,l.Property.FIELD,l.Property.BIN,l.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==o.Channel.ROW&&e.channel!==o.Channel.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[l.Property.CHANNEL,l.Property.FIELD,l.Property.BIN,l.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==o.Channel.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[l.Property.TYPE,l.Property.SCALE,l.getEncodingNestedProp("scale","type"),l.Property.TIMEUNIT,l.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.type,a=y.scaleType(e);if(g.contains([c.Type.ORDINAL,c.Type.NOMINAL],i))return void 0===a||u.hasDiscreteDomain(a);if(i===c.Type.TEMPORAL)return e.timeUnit?g.contains([u.ScaleType.TIME,u.ScaleType.UTC,void 0],a)||u.hasDiscreteDomain(a):g.contains([u.ScaleType.TIME,u.ScaleType.UTC,void 0],a);if(i===c.Type.QUANTITATIVE)return e.bin?g.contains([u.ScaleType.LINEAR,void 0],a):g.contains([u.ScaleType.LOG,u.ScaleType.POW,u.ScaleType.SQRT,u.ScaleType.QUANTILE,u.ScaleType.QUANTIZE,u.ScaleType.LINEAR,void 0],a)}return!0}}].map(function(e){return new h(e)}),n.ENCODING_CONSTRAINT_INDEX=n.ENCODING_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var E=n.ENCODING_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new f.PropIndex);n.checkEncoding=r},{"../property":11,"../propindex":12,"../query/encoding":13,"../schema":26,"../util":28,"../wildcard":29,"./base":2,"vega-lite/src/aggregate":43,"vega-lite/src/channel":46,"vega-lite/src/scale":53,"vega-lite/src/type":57}],5:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var a=v.get(e)||[],o=0,u=a;o<u.length;o++){var c=u[o];if(c.strict()||i[c.name()]){var s=c.satisfy(n,r,i);if(!s){var l="(spec) "+c.name();return i.verbose&&console.log(l+" failed with "+n.toShorthand()+" for "+t.name),l}}}return null}var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/channel"),u=e("vega-lite/src/mark"),c=e("vega-lite/src/scale"),s=e("vega-lite/src/type"),l=e("./base"),f=e("../wildcard"),d=e("../property"),p=e("../propindex"),g=e("../query/encoding"),y=e("../util"),h=e("../query/encoding"),E=o.NONSPATIAL_CHANNELS.reduce(function(e,t){return e[t]=!0,e},{}),m=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return y.every(this.constraint.properties,function(t){if(t===d.Property.MARK)return!f.isWildcard(e.getMark());if(d.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return y.every(e.getEncodings(),function(e){return!e[n]||!f.isWildcard(e[n][r])})}if(!d.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return y.every(e.getEncodings(),function(e){return!e[t]||!f.isWildcard(e[t])})})},t.prototype.satisfy=function(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)},t}(l.AbstractConstraintModel);n.SpecConstraintModel=m,n.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[d.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r={};return y.every(e.getEncodings(),function(e){return!!f.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[d.Property.MARK,d.Property.SCALE,d.getEncodingNestedProp("scale","zero"),d.Property.CHANNEL,d.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.BAR)for(var a=0,c=i;a<c.length;a++){var l=c[a];if((l.channel===o.Channel.X||l.channel===o.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[d.Property.BIN,d.Property.TIMEUNIT,d.Property.TYPE,d.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=y.some(e.getEncodings(),function(e){return e.autoCount===!0});if(r)return y.every(e.getEncodings(),function(e){if(void 0!==e.autoCount)return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],a=y.every(i,function(t){return!f.isWildcard(e.getEncodingQueryByIndex(t).autoCount)});return!a||y.some(e.getEncodings(),function(e){return e.type===s.Type.QUANTITATIVE?e.autoCount!==!1&&(!e.bin||f.isWildcard(e.bin)):e.type===s.Type.TEMPORAL&&(!e.timeUnit||f.isWildcard(e.timeUnit))})}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[d.Property.CHANNEL,d.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r=e.getMark();return!!f.isWildcard(r)||y.every(e.getEncodings(),function(e){return!!f.isWildcard(e.channel)||o.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[d.Property.CHANNEL,d.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(o.Channel.X)&&e.channelUsed(o.Channel.Y);case u.Mark.TEXT:return e.channelUsed(o.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(o.Channel.X)||e.channelUsed(o.Channel.Y);case u.Mark.POINT:return!e.wildcardIndex.hasProperty(d.Property.CHANNEL)||e.channelUsed(o.Channel.X)||e.channelUsed(o.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"All required channels for the specified mark should be specified",properties:[d.Property.CHANNEL,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(e.isAggregate()){var r=!1,i=!1,a=!1;if(e.specQuery.encodings.forEach(function(t,n){t.autoCount!==!1&&(t.aggregate||t.autoCount||(i=!0,y.contains([o.Channel.ROW,o.Channel.COLUMN],t.channel)?e.wildcardIndex.hasEncodingProperty(n,d.Property.CHANNEL)&&(a=!0):r=!0))}),i&&!r&&(a||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[d.Property.AGGREGATE,d.Property.AUTOCOUNT,d.Property.BIN,d.Property.TIMEUNIT,d.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()||y.some(e.getEncodings(),function(e){return!!g.isDimension(e)})}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[d.Property.MARK,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!y.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())||e.isAggregate()}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[d.Property.CHANNEL,d.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getMark();if(y.contains([u.Mark.TICK,u.Mark.BAR],r)&&e.channelUsed(o.Channel.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;for(var i=e.specQuery.encodings,a=0;a<i.length;a++){var c=i[a];if(c.channel===o.Channel.SIZE)return!e.wildcardIndex.hasEncodingProperty(a,d.Property.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[d.Property.MARK,d.Property.CHANNEL,d.Property.SCALE,d.getEncodingNestedProp("scale","type"),d.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.AREA||r===u.Mark.BAR)for(var a=0,s=i;a<s.length;a++){var l=s[a];if((l.channel===o.Channel.X||l.channel===o.Channel.Y)&&l.scale){var f=h.scaleType(l);if(f===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[d.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=0,a=!1,o=0;o<r.length;o++){var u=r[o];if(u.autoCount!==!1){var c=u.channel;if(!f.isWildcard(c)&&E[c+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(o,d.Property.CHANNEL)&&(a=!0),i>1&&(a||n.constraintManuallySpecifiedValue)))return!1}}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[d.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=!1,a=!1,u=!1,c=!1,s=0;s<r.length;s++){var l=r[s];if(l.autoCount!==!1){var p=l.channel;p===o.Channel.X?u=!0:p===o.Channel.Y?c=!0:f.isWildcard(p)||(i=!0,e.wildcardIndex.hasEncodingProperty(s,d.Property.CHANNEL)&&(a=!0))}}return!(a||n.constraintManuallySpecifiedValue&&i)||u&&c}},{name:"omitRaw",description:"Omit raw plots.",properties:[d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[d.Property.AGGREGATE,d.Property.AUTOCOUNT,d.Property.TIMEUNIT,d.Property.BIN,d.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){if(e.isAggregate())for(var r=e.specQuery.encodings,i=0;i<r.length;i++){var a=r[i];if(a.autoCount!==!1){if(a.type===s.Type.TEMPORAL&&!a.timeUnit&&(e.wildcardIndex.hasEncodingProperty(i,d.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(a.type===s.Type.QUANTITATIVE&&!a.bin&&!a.aggregate&&!a.autoCount){if(e.wildcardIndex.hasEncodingProperty(i,d.Property.BIN)||e.wildcardIndex.hasEncodingProperty(i,d.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(i,d.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[d.Property.CHANNEL,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){return!!e.isAggregate()||y.every(e.specQuery.encodings,function(t,r){return t.autoCount===!1||(t.channel!==o.Channel.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,d.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[d.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r={},i={},a=e.specQuery.encodings,o=0;o<a.length;o++){var u=a[o];if(u.field&&!f.isWildcard(u.field)){var c=u.field;if(e.wildcardIndex.hasEncodingProperty(o,d.Property.FIELD)&&(i[c]=!0),r[c]&&(i[c]||n.constraintManuallySpecifiedValue))return!1;r[c]=!0}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[d.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getEncodings();return 1!==r.length||r[0].channel!==o.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[d.Property.CHANNEL,d.Property.MARK,d.Property.TYPE,d.Property.TIMEUNIT,d.Property.BIN,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(o.Channel.X),a=e.getEncodingQueryByChannel(o.Channel.Y),c=i&&h.isMeasure(i),l=a&&h.isMeasure(a);return i&&a&&c!==l&&!(!c&&i.type===s.Type.NOMINAL)&&!(!l&&a.type===s.Type.NOMINAL)}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:return!e.channelUsed(o.Channel.SIZE)&&e.isMeasure(o.Channel.X)!==e.isMeasure(o.Channel.Y);case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitNonLinearScaleTypeWithStack",description:"Stacked plot should only use linear scale",properties:[d.Property.CHANNEL,d.Property.MARK,d.Property.AGGREGATE,d.Property.AUTOCOUNT,d.Property.SCALE,d.getEncodingNestedProp("scale","type"),d.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.stack();if(r)for(var i=0,a=e.getEncodings();i<a.length;i++){var u=a[i];if((u.aggregate||u.autoCount===!0)&&u.type===s.Type.QUANTITATIVE&&y.contains([o.Channel.X,o.Channel.Y],u.channel)&&h.scaleType(u)!==c.ScaleType.LINEAR)return!1}return!0}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[d.Property.CHANNEL,d.Property.MARK,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.stack();if(r){var i=e.getEncodingQueryByChannel(r.fieldChannel);return y.contains(a.SUM_OPS,i.aggregate)||!!i.autoCount}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both dimensions should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[d.Property.CHANNEL,d.Property.TYPE,d.Property.TIMEUNIT,d.Property.BIN,d.Property.AGGREGATE,d.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!(n.autoAddCount&&e.isDimension(o.Channel.X)&&e.isDimension(o.Channel.Y)&&!e.isAggregate())}}].map(function(e){return new m(e)}),n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var v=n.SPEC_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new p.PropIndex);n.checkSpec=r},{"../property":11,"../propindex":12,"../query/encoding":13,"../util":28,"../wildcard":29,"./base":2,"vega-lite/src/aggregate":43,"vega-lite/src/channel":46,"vega-lite/src/mark":52,"vega-lite/src/scale":53,"vega-lite/src/type":57}],6:[function(e,t,n){"use strict";n.version="0.9.2";var r=e("./util");n.config=e("./config"),n.constraint=e("./constraint/constraint"),n.enumerate=e("./enumerator"),n.wildcard=e("./wildcard");var i=e("./generate");n.generate=i.generate,n.model=e("./model"),n.nest=e("./nest"),n.property=e("./property");var a=e("./query/query"),o=e("./query/query");n.query=r.extend(o.query,a),n.ranking=e("./ranking/ranking"),n.schema=e("./schema"),n.util=e("./util")},{"./config":1,"./constraint/constraint":3,"./enumerator":7,"./generate":8,"./model":9,"./nest":10,"./property":11,"./query/query":15,"./ranking/ranking":25,"./schema":26,"./util":28,"./wildcard":29}],7:[function(e,t,n){"use strict";function r(e){return s.get(e)}function i(e){return function(t,n,r){return function(i,u){function c(l){if(l===s.length)return void i.push(u.duplicate());var f=s[l],d=t.encodings[f].get(e),p=u.getEncodingQueryByIndex(f),g=u.getEncodingProperty(f,e);p.autoCount!==!1&&g?(d["enum"].forEach(function(t){null===t&&(t=void 0),u.setEncodingProperty(f,e,t,d);var i=a.checkEncoding(e,d,f,u,n,r);if(!i){var s=o.checkSpec(e,d,u,n,r);s||c(l+1)}}),u.resetEncodingProperty(f,e,d)):c(l+1)}var s=t.encodingIndicesByProperty.get(e);return c(0),i}}}var a=e("./constraint/encoding"),o=e("./constraint/spec"),u=e("./property"),c=e("./propindex"),s=new c.PropIndex;n.getEnumerator=r,s.set("mark",function(e,t,n){return function(r,i){var a=i.getMark();return a["enum"].forEach(function(a){i.setMark(a);var u=o.checkSpec("mark",e.mark,i,t,n);u||r.push(i.duplicate())}),i.resetMark(),r}}),u.ENCODING_TOPLEVEL_PROPS.forEach(function(e){s.set(e,i(e))}),u.ENCODING_NESTED_PROPS.forEach(function(e){s.set(e,i(e))}),n.EncodingPropertyGeneratorFactory=i},{"./constraint/encoding":4,"./constraint/spec":5,"./property":11,"./propindex":12}],8:[function(e,t,n){"use strict";function r(e,t,n){void 0===n&&(n=i.DEFAULT_QUERY_CONFIG);var r=o.SpecQueryModel.build(e,t,n),s=r.wildcardIndex,l=[r];return n.propertyPrecedence.forEach(function(e){var r=u.fromKey(e);if(s.hasProperty(r)){var i=a.getEnumerator(r),o=i(s,t,n);l=l.reduce(o,[])}}),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?l:c.stylize(l,t,n)}var i=e("./config"),a=e("./enumerator"),o=e("./model"),u=e("./property"),c=e("./stylize");n.generate=r},{"./config":1,"./enumerator":7,"./model":9,"./property":11,"./stylize":27}],9:[function(e,t,n){"use strict";var r=e("vega-lite/src/aggregate"),i=e("vega-lite/src/type"),a=e("./property"),o=e("./wildcard"),u=e("./wildcardindex"),c=e("./query/spec"),s=e("./query/encoding"),l=e("./query/groupby"),f=e("./query/shorthand"),d=e("./util"),p=function(){function e(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelCount=e.encodings.reduce(function(e,t){return o.isWildcard(t.channel)||t.autoCount===!1||(e[t.channel+""]=1),e},{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}return e.build=function(t,n,r){var c=new u.WildcardIndex;if(o.isWildcard(t.mark)){var s=o.getDefaultName(a.Property.MARK);t.mark=o.initWildcard(t.mark,s,r["enum"].mark),c.setMark(t.mark)}if(t.encodings.forEach(function(e,t){void 0!==e.autoCount&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=i.Type.QUANTITATIVE),void 0===e.type&&(e.type=o.SHORT_WILDCARD),a.ENCODING_TOPLEVEL_PROPS.forEach(function(i){if(o.isWildcard(e[i])){var a=o.getDefaultName(i)+t,u=o.getDefaultEnumValues(i,n,r),s=e[i]=o.initWildcard(e[i],a,u);c.setEncodingProperty(t,i,s)}}),a.ENCODING_NESTED_PROPS.forEach(function(i){var a=e[i.parent];if(a){var u=i.child;if(o.isWildcard(a[u])){var s=o.getDefaultName(i)+t,l=o.getDefaultEnumValues(i,n,r),f=a[u]=o.initWildcard(a[u],s,l);c.setEncodingProperty(t,i,f)}}})}),r.autoAddCount){var l={channel:{name:o.getDefaultName(a.Property.CHANNEL)+t.encodings.length,"enum":o.getDefaultEnumValues(a.Property.CHANNEL,n,r)},autoCount:{name:o.getDefaultName(a.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},type:i.Type.QUANTITATIVE};t.encodings.push(l);var f=t.encodings.length-1;c.setEncodingProperty(f,a.Property.CHANNEL,l.channel),c.setEncodingProperty(f,a.Property.AUTOCOUNT,l.autoCount)}return new e(t,c,n,r,{})},Object.defineProperty(e.prototype,"wildcardIndex",{get:function(){return this._wildcardIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(d.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,d.duplicate(this._assignedWildcardIndex))},e.prototype.setMark=function(e){var t=this._spec.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var n=this._spec.encodings[e];return a.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]},e.prototype.setEncodingProperty=function(e,t,n,r){var i=this._spec.encodings[e];t===a.Property.CHANNEL&&i.channel&&!o.isWildcard(i.channel)&&this._channelCount[i.channel]--,a.isEncodingNestedProp(t)?i[t.parent][t.child]=n:a.hasNestedProperty(t)&&n===!0?i[t]=d.extend({},i[t],{"enum":void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===a.Property.CHANNEL&&(this._channelCount[n]=(this._channelCount[n]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,n){var r=this._spec.encodings[e];t===a.Property.CHANNEL&&this._channelCount[r.channel]--,a.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]},e.prototype.channelUsed=function(e){return this._channelCount[e]>0},e.prototype.stack=function(){return c.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return e.autoCount!==!1})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t];if(r.channel===e)return r}},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isDimension=function(e){var t=this.getEncodingQueryByChannel(e);return t&&s.isDimension(t)},e.prototype.isMeasure=function(e){var t=this.getEncodingQueryByChannel(e);return t&&s.isMeasure(t)},e.prototype.isAggregate=function(){return c.isAggregate(this._spec)},e.prototype.toShorthand=function(e){if(e){var t=l.parseGroupBy(e);return f.spec(this._spec,t.include,t.replacer)}return f.spec(this._spec)},e.prototype._encoding=function(){for(var e={},t=0,n=this._spec.encodings;t<n.length;t++){var u=n[t],c={};if(u.autoCount===!0)c.aggregate=r.AggregateOp.COUNT,c.field="*",c.type=i.Type.QUANTITATIVE;else if(u.autoCount===!1)continue;if(o.isWildcard(u.channel))return null;for(var s=[a.Property.AGGREGATE,a.Property.BIN,a.Property.TIMEUNIT,a.Property.FIELD,a.Property.TYPE,a.Property.SCALE,a.Property.SORT,a.Property.AXIS,a.Property.LEGEND],l=0,d=s;l<d.length;l++){
var p=d[l];if(o.isWildcard(u[p]))return null;void 0!==u[p]&&(f.PROPERTY_SUPPORTED_CHANNELS[p]&&!f.PROPERTY_SUPPORTED_CHANNELS[p][u.channel]||(c[p]=u[p]))}c.bin===!1&&delete c.bin,e[u.channel]=c}return e},e.prototype.toSpec=function(e){if(o.isWildcard(this._spec.mark))return null;var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=this._encoding(),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=d.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();n.SpecQueryModel=p;var g=function(){function e(e,t,n,r,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r=void 0),void 0===i&&(i=void 0),this._name=e,this._path=t,this._items=n,this._groupBy=r,this._orderGroupBy=i}return e.prototype.getTopSpecQueryModel=function(){var t=this._items[0];return t instanceof e?t.getTopSpecQueryModel():t},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupBy",{get:function(){return this._groupBy},set:function(e){this._groupBy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orderGroupBy",{get:function(){return this._orderGroupBy},set:function(e){this._orderGroupBy=e},enumerable:!0,configurable:!0}),e}();n.SpecQueryModelGroup=g},{"./property":11,"./query/encoding":13,"./query/groupby":14,"./query/shorthand":16,"./query/spec":17,"./util":28,"./wildcard":29,"./wildcardindex":30,"vega-lite/src/aggregate":43,"vega-lite/src/type":57}],10:[function(e,t,n){"use strict";function r(e,t){g[e]=t}function i(e,t){if(t.nest){for(var n=new c.SpecQueryModelGroup,r={},i=[],a=[],o=[],s=0;s<t.nest.length;s++){i.push(s>0?i[s-1].duplicate():new l.PropIndex),a.push(s>0?a[s-1].duplicate():new l.PropIndex);var p=t.nest[s].groupBy;if(u.isArray(p)){var y=f.parseGroupBy(p,i[s],a[s]);o.push(y.replacer)}}return e.forEach(function(e){for(var a="",s=n,l=0;l<t.nest.length;l++){var f=s.groupBy=t.nest[l].groupBy;s.orderGroupBy=t.nest[l].orderGroupBy;var p=u.isArray(f)?d.spec(e.specQuery,i[l],o[l]):g[f](e);a+="/"+p,r[a]||(r[a]=new c.SpecQueryModelGroup(p,a,[]),s.items.push(r[a])),s=r[a]}s.items.push(e)}),n}return new c.SpecQueryModelGroup("","",e)}function a(e){var t=p.stack(e.specQuery);return t?"stack="+t.offset+"|":""}var o=e("vega-lite/src/channel"),u=e("datalib/src/util"),c=e("./model"),s=e("./property"),l=e("./propindex"),f=e("./query/groupby"),d=e("./query/shorthand"),p=e("./query/spec"),g={};n.registerKeyFn=r,n.FIELD="field",n.FIELD_TRANSFORM="fieldTransform",n.ENCODING="encoding",n.TRANSPOSE="transpose",n.SPEC="spec",n.nest=i;var y=[s.Property.FIELD],h=f.parseGroupBy(y);r(n.FIELD,function(e){return d.spec(e.specQuery,h.include,h.replacer)}),n.PARSED_GROUP_BY_FIELD_TRANSFORM=f.parseGroupBy(f.GROUP_BY_FIELD_TRANSFORM),r(n.FIELD_TRANSFORM,function(e){return d.spec(e.specQuery,n.PARSED_GROUP_BY_FIELD_TRANSFORM.include,n.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer)}),n.PARSED_GROUP_BY_ENCODING=f.parseGroupBy(f.GROUP_BY_ENCODING),r(n.ENCODING,function(e){return d.spec(e.specQuery,n.PARSED_GROUP_BY_ENCODING.include,n.PARSED_GROUP_BY_ENCODING.replacer)}),r(n.TRANSPOSE,function(e){return e.getMark()+"|"+a(e)+e.getEncodings().map(function(e){var t=d.fieldDef(e),n=e.channel===o.Channel.X||e.channel===o.Channel.Y?"xy":e.channel===o.Channel.ROW||e.channel===o.Channel.COLUMN?"facet":e.channel;return n+":"+t}).sort().join("|")}),r(n.SPEC,function(e){return JSON.stringify(e.specQuery)})},{"./model":9,"./property":11,"./propindex":12,"./query/groupby":14,"./query/shorthand":16,"./query/spec":17,"datalib/src/util":38,"vega-lite/src/channel":46}],11:[function(e,t,n){"use strict";function r(e){return!!e.parent}function i(e){return e in f}function a(e){return p[e]}function o(e){return r(e)?e.parent+E+e.child:e}function u(e){var t=e.split(E);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}function c(e,t){return(m[e]||{})[t]}function s(e){return i(e)||r(e)}var l=e("./util");n.isEncodingNestedProp=r,n.ENCODING_TOPLEVEL_PROPS=["channel","aggregate","autoCount","bin","timeUnit","hasFn","sort","field","type","scale","axis","legend"];var f=l.toMap(n.ENCODING_TOPLEVEL_PROPS);n.isEncodingTopLevelProperty=i;var d=["bin","scale","sort","axis","legend"],p=l.toMap(d);n.hasNestedProperty=a,n.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],n.SORT_CHILD_PROPS=["field","op","order"],n.SCALE_CHILD_PROPS=["clamp","domain","exponent","nice","range","rangeStep","round","type","useRawDomain","zero"],n.AXIS_CHILD_PROPS=["axisColor","axisWidth","format","offset","orient","shortTimeLabels","subdivide","values","zindex","grid","gridColor","gridDash","gridOpacity","gridWidth","labels","labelAngle","labelMaxLength","ticks","tickColor","tickLabelColor","tickLabelFont","tickLabelFontSize","tickPadding","tickSize","tickSizeMajor","tickSizeMinor","tickSizeEnd","tickWidth","title","titleColor","titleFont","titleFontSize","titleFontWeight","titleOffset","titleMaxLength"],n.LEGEND_CHILD_PROPS=["format","orient","offset","shortTimeLabels","values","labelAlign","labelBaseline","labelColor","labelFont","labelFontSize","symbolColor","symbolShape","symbolSize","symbolStrokeWidth","title","titleColor","titleFont","titleFontSize","titleFontWeight"];var g=n.BIN_CHILD_PROPS.map(function(e){return{parent:"bin",child:e}});n.SORT_PROPS=n.SORT_CHILD_PROPS.map(function(e){return{parent:"sort",child:e}}),n.SCALE_PROPS=n.SCALE_CHILD_PROPS.map(function(e){return{parent:"scale",child:e}});var y=n.AXIS_CHILD_PROPS.map(function(e){return{parent:"axis",child:e}}),h=n.LEGEND_CHILD_PROPS.map(function(e){return{parent:"legend",child:e}});n.ENCODING_NESTED_PROPS=[].concat(g,n.SORT_PROPS,n.SCALE_PROPS,y,h);var E=".";n.toKey=o,n.fromKey=u;var m=n.ENCODING_NESTED_PROPS.reduce(function(e,t){return e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e},{});n.getEncodingNestedProp=c,n.isEncodingProperty=s,n.ALL_ENCODING_PROPS=[].concat(n.ENCODING_TOPLEVEL_PROPS,n.ENCODING_NESTED_PROPS),n.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","scale","sort","axis","legend"].concat(g,n.SCALE_PROPS,y,h);var v;!function(e){e.MARK="mark",e.FILTER="filter",e.CALCULATE="calculate",e.FILTERINVALID="filterInvalid",e.STACK="stack",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend"}(v=n.Property||(n.Property={}))},{"./util":28}],12:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=e("./util"),a=e("./property"),o=function(){function e(e){void 0===e&&(e=null),this.index=e?r({},e):{}}return e.prototype.has=function(e){return a.toKey(e)in this.index},e.prototype.get=function(e){return this.index[a.toKey(e)]},e.prototype.set=function(e,t){return this.index[a.toKey(e)]=t,this},e.prototype.setByKey=function(e,t){this.index[e]=t},e.prototype.map=function(t){var n=new e;for(var r in this.index)n.index[r]=t(this.index[r]);return n},e.prototype.size=function(){return i.keys(this.index).length},e.prototype.duplicate=function(){return new e(this.index)},e}();n.PropIndex=o},{"./property":11,"./util":28}],13:[function(e,t,n){"use strict";function r(e){return s.contains([o.Type.NOMINAL,o.Type.ORDINAL],e.type)||!c.isWildcard(e.bin)&&!!e.bin||!c.isWildcard(e.timeUnit)&&!!e.timeUnit}function i(e){return e.type===o.Type.QUANTITATIVE&&!e.bin||e.type===o.Type.TEMPORAL&&!e.timeUnit}function a(e){var t=e.scale===!0||e.scale===c.SHORT_WILDCARD?{}:e.scale||{},n=e.type,r=e.channel,i=e.timeUnit,a=void 0,o=!1,s={};if(!(c.isWildcard(t.type)||c.isWildcard(n)||c.isWildcard(r))){var l=void 0;if("temporal"!==n||!c.isWildcard(i))return u["default"](t.type,n,r,i,a,o,l,s)}}var o=e("vega-lite/src/type"),u=e("vega-lite/src/compile/scale/type"),c=e("../wildcard"),s=e("../util");n.isDimension=r,n.isMeasure=i,n.scaleType=a},{"../util":28,"../wildcard":29,"vega-lite/src/compile/scale/type":47,"vega-lite/src/type":57}],14:[function(e,t,n){"use strict";function r(e){return o.isObject(e)&&!!e.property}function i(e,t,n){return t=t||new s.PropIndex,n=n||new s.PropIndex,e.forEach(function(e){r(e)?(t.setByKey(e.property,!0),n.setByKey(e.property,e.replace)):t.setByKey(e,!0)}),{include:t,replaceIndex:n,replacer:u.getReplacerIndex(n)}}function a(e){return o.isArray(e)?e.map(function(e){if(r(e)){if(e.replace){var t=l.keys(e.replace).reduce(function(t,n){var r=e.replace[n];return(t[r]=t[r]||[]).push(n),t},{});return e.property+"["+l.keys(t).map(function(e){var n=t[e].sort();return n.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}var o=e("datalib/src/util"),u=e("./shorthand"),c=e("../property"),s=e("../propindex"),l=e("../util");n.REPLACE_BLANK_FIELDS={"*":""},n.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},n.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},n.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},n.isExtendedGroupBy=r,n.parseGroupBy=i,n.toString=a,n.GROUP_BY_FIELD_TRANSFORM=[c.Property.FIELD,c.Property.TYPE,c.Property.AGGREGATE,c.Property.BIN,c.Property.TIMEUNIT,c.Property.STACK],n.GROUP_BY_ENCODING=n.GROUP_BY_FIELD_TRANSFORM.concat([{property:c.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])},{"../property":11,"../propindex":12,"../util":28,"./shorthand":16,"datalib/src/util":38}],15:[function(e,t,n){"use strict";function r(e,t,n){e=s.extend({},i(e),{config:s.extend({},a.DEFAULT_QUERY_CONFIG,n,e.config)});var r=o.generate(e.spec,t,e.config),l=u.nest(r,e),f=c.rank(l,e,t,0);return{query:e,result:f}}function i(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var n={spec:s.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return s.duplicate(e)}var a=e("../config"),o=e("../generate"),u=e("../nest"),c=e("../ranking/ranking"),s=e("../util");n.encoding=e("./encoding"),n.groupBy=e("./groupby"),n.shorthand=e("./shorthand"),n.spec=e("./spec"),n.transform=e("./transform"),n.query=r,n.normalize=i},{"../config":1,"../generate":8,"../nest":10,"../ranking/ranking":25,"../util":28,"./encoding":13,"./groupby":14,"./shorthand":16,"./spec":17,"./transform":18}],16:[function(e,t,n){"use strict";function r(e){return e.map(function(e){return i(e)})}function i(e){return function(t){return void 0!==e[t]?e[t]:t}}function a(e,t){return A.isWildcard(e)?!A.isShortWildcard(e)&&e["enum"]?A.SHORT_WILDCARD+JSON.stringify(e["enum"]):A.SHORT_WILDCARD:t?t(e):e}function o(e,t){return t?t(e):e}function u(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=N.fromSpec(e);return c(i,t,r)}function c(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(S.Property.MARK)&&i.push(a(e.mark,r.get(S.Property.MARK))),e.transform&&(t.get(S.Property.CALCULATE)&&void 0!==e.transform.calculate&&i.push("calculate:"+s(e.transform.calculate)),t.get(S.Property.FILTER)&&void 0!==e.transform.filter&&i.push("filter:"+JSON.stringify(e.transform.filter)),t.get(S.Property.FILTERINVALID)&&void 0!==e.transform.filterInvalid&&i.push("filterInvalid:"+e.transform.filterInvalid)),t.get(S.Property.STACK)){var o=N.stack(e);if(o){var u=t.duplicate().set("type",!1),c=f(o.fieldEncQ,u,r),d=f(o.groupByEncQ,u,r);i.push("stack={field:"+c+","+(d?"by:"+d+",":"")+"offset:"+o.offset+"}")}}if(e.encodings){var p=e.encodings.reduce(function(e,n){if(n.autoCount!==!1){var i=l(n,t,r);i&&e.push(i)}return e},[]).sort().join("|");p&&i.push(p)}return i.join("|")}function s(e){return JSON.stringify(e.reduce(function(e,t){return e[t.as]=t.expr,e},{}))}function l(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];t.get(S.Property.CHANNEL)&&i.push(a(e.channel,r.get(S.Property.CHANNEL)));var o=f(e,t,r);return o&&i.push(o),i.join(":")}function f(e,t,r){if(void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE),t.get(S.Property.AGGREGATE)&&e.autoCount===!1)return"-";var i=d(e,t,r),o=p(e,t,r),u=t.get("field")?a(e.field||"*",r.get("field")):"...";if(t.get(S.Property.TYPE))if(A.isWildcard(e.type))u+=","+a(e.type,r.get(S.Property.TYPE));else{var c=((e.type||v.Type.QUANTITATIVE)+"").substr(0,1);u+=","+a(c,r.get(S.Property.TYPE))}if(u+=o.map(function(e){var t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t}).join(""),i){var s=T.isString(i)?i:A.SHORT_WILDCARD+(O.keys(i).length>0?JSON.stringify(i):"");return s+"("+u+")"}return u}function d(e,t,n){if(t.get(S.Property.AGGREGATE)&&e.aggregate&&!A.isWildcard(e.aggregate))return o(e.aggregate,n.get(S.Property.AGGREGATE));if(t.get(S.Property.AGGREGATE)&&e.autoCount&&!A.isWildcard(e.autoCount))return o("count",n.get(S.Property.AGGREGATE));if(t.get(S.Property.TIMEUNIT)&&e.timeUnit&&!A.isWildcard(e.timeUnit))return o(e.timeUnit,n.get(S.Property.TIMEUNIT));if(t.get(S.Property.BIN)&&e.bin&&!A.isWildcard(e.bin))return"bin";for(var r=null,i=0,a=[S.Property.AGGREGATE,S.Property.AUTOCOUNT,S.Property.TIMEUNIT,S.Property.BIN];i<a.length;i++){var u=a[i],c=e[u];t.get(u)&&e[u]&&A.isWildcard(c)&&(r=r||{},r[u]=A.isShortWildcard(c)?c:c["enum"])}return r&&e.hasFn&&(r.hasFn=!0),r}function p(e,t,r){var i=[];if(!O.isBoolean(e.bin)&&!A.isShortWildcard(e.bin)){var u=e.bin;for(var c in u){var s=S.getEncodingNestedProp("bin",c);s&&t.get(s)&&void 0!==u[c]&&i.push({key:c,value:a(u[c],r.get(s))})}i.sort(function(e,t){return e.key.localeCompare(t.key)})}for(var l=0,f=[S.Property.SCALE,S.Property.SORT,S.Property.AXIS,S.Property.LEGEND];l<f.length;l++){var d=f[l];if((A.isWildcard(e.channel)||n.PROPERTY_SUPPORTED_CHANNELS[d][e.channel])&&t.get(d)&&void 0!==e[d]){var p=e[d];if(O.isBoolean(p)||null===p)i.push({key:d+"",value:p||!1});else if(T.isString(p))i.push({key:d+"",value:o(JSON.stringify(p),r.get(d))});else{var g=[];for(var c in p){var y=S.getEncodingNestedProp(d,c);y&&t.get(y)&&void 0!==p[c]&&g.push({key:c,value:a(p[c],r.get(y))})}if(g.length>0){var h=g.sort(function(e,t){return e.key.localeCompare(t.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});i.push({key:d+"",value:JSON.stringify(h)})}}}}return i}function g(e){for(var t=e.split("|"),n={mark:t[0],encodings:[]},r=1;r<t.length;r++){var i=t[r],a=y(i,":",1),o=a[0],u=a[1];if(I[o]||"?"===o){var c=D.encoding(o,u);n.encodings.push(c)}else if("calculate"!==o)"filter"!==o?"filterInvalid"!==o||(n.transform=n.transform||{},n.transform.filterInvalid=JSON.parse(u)):(n.transform=n.transform||{},n.transform.filter=JSON.parse(u));else{n.transform=n.transform||{};var s=[],l=JSON.parse(u);for(var f in l)s.push({expr:l[f],as:f});n.transform.calculate=s}}return n}function y(e,t,n){for(var r=[],i=0,a=0;a<n;a++){var o=e.indexOf(t,i);if(o===-1)break;r.push(e.substring(i,o)),i=o+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var h=e("vega-lite/src/aggregate"),E=e("vega-lite/src/channel"),m=e("vega-lite/src/timeunit"),v=e("vega-lite/src/type"),T=e("datalib/src/util"),N=e("./spec"),A=e("../wildcard"),S=e("../property"),C=e("../propindex"),O=e("../util");n.getReplacerIndex=r,n.getReplacer=i,n.value=a,n.replace=o,n.REPLACE_NONE=new C.PropIndex,n.INCLUDE_ALL=S.DEFAULT_PROP_PRECEDENCE.concat(S.SORT_PROPS,[S.Property.CALCULATE,S.Property.FILTER,S.Property.FILTERINVALID,S.Property.STACK]).reduce(function(e,t){return e.set(t,!0)},new C.PropIndex),n.vlSpec=u,n.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0}},n.spec=c,n.calculate=s,n.encoding=l,n.fieldDef=f;var I=T.toMap(E.CHANNELS),P=T.toMap(h.AGGREGATE_OPS),R=T.toMap(m.SINGLE_TIMEUNITS),M=T.toMap(m.MULTI_TIMEUNITS);n.parse=g,n.splitWithTail=y;var D;!function(e){function t(e,t){var r={channel:e};return r=t.indexOf("(")!==-1?i(r,t):n(r,y(t,",",2))}function n(e,t){e.field=t[0],e.type=v.getFullName(t[1].toUpperCase())||"?";for(var n=t[2],i=0,a=0;a<n.length;){var o=n.indexOf("=",a),u=void 0;if(o===-1)break;var c=n.substring(a,o);if("{"===n[a+c.length+1]){var s=a+c.length+1;i=r(s,n,"}");var l=n.substring(s,i+1);u=JSON.parse(l),a=i+2}else if("["===n[a+c.length+1]){var f=a+c.length+1,d=r(f,n,"]"),p=n.substring(f,d+1);u=JSON.parse(p),a=d+2}else{var g=a,y=n.indexOf(",",a+c.length);y===-1&&(y=n.length),a=y+1,u=JSON.parse(n.substring(g+c.length+1,y))}S.hasNestedProperty(c)?e[c]=u:e.bin[c]=u}return e}function r(e,t,n){for(var r=e;r<t.length;r++)if(t[r]===n)return r}function i(e,t){if("?"===t[0]){var i=r(1,t,"}"),a=JSON.parse(t.substring(1,i+1));for(var o in a)O.isArray(a[o])?e[o]={"enum":a[o]}:e[o]=a[o];return n(e,y(t.substring(i+2,t.length-1),",",2))}var u=t.substring(0,t.indexOf("(")),c=t.substring(u.length+1,t.length-1),s=y(c,",",2);return P[u]?(e.aggregate=u,n(e,s)):M[u]||R[u]?(e.timeUnit=u,n(e,s)):"bin"===u?(e.bin={},n(e,s)):void 0}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(D=n.shorthandParser||(n.shorthandParser={}))},{"../property":11,"../propindex":12,"../util":28,"../wildcard":29,"./spec":17,"datalib/src/util":38,"vega-lite/src/aggregate":43,"vega-lite/src/channel":46,"vega-lite/src/timeunit":56,"vega-lite/src/type":57}],17:[function(e,t,n){"use strict";function r(e){return l.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:l.keys(e.encoding).map(function(t){var n={channel:t},r=e.encoding[t];for(var i in r)s.isEncodingTopLevelProperty(i)&&void 0!==r[i]&&(l.contains(["bin","scale","axis","legend"],i)&&null===r[i]?n[i]=!1:n[i]=r[i]);return n})},e.config?{config:e.config}:{})}function i(e){return l.some(e.encodings,function(e){return!c.isWildcard(e.aggregate)&&!!e.aggregate||e.autoCount===!0})}function a(e){var t=e.config,n=t&&t.mark?t.mark.stacked:void 0;if(l.contains([u.StackOffset.NONE,null,!1],n))return null;if(!l.contains(["bar","area"],e.mark))return null;if(!i(e))return null;var r=e.encodings.reduce(function(e,t){return l.contains(o.STACK_GROUP_CHANNELS,t.channel)&&!t.aggregate&&e.push({channel:t.channel,fieldDef:t}),e},[]);if(0===r.length)return null;var a=e.encodings.reduce(function(e,t){return e||(t.channel===o.Channel.X?t:null)},null),c=e.encodings.reduce(function(e,t){return e||(t.channel===o.Channel.Y?t:null)},null),s=!(!a||!a.aggregate&&!a.autoCount),f=!(!c||!c.aggregate&&!c.autoCount);return s!==f?{groupbyChannel:s?c?o.Y:null:a?o.X:null,groupByEncQ:s?c:a,fieldChannel:s?o.X:o.Y,fieldEncQ:s?a:c,stackBy:r,offset:n||u.StackOffset.ZERO}:null}var o=e("vega-lite/src/channel"),u=e("vega-lite/src/stack"),c=e("../wildcard"),s=e("../property"),l=e("../util");n.fromSpec=r,n.isAggregate=i,n.stack=a},{"../property":11,"../util":28,"../wildcard":29,"vega-lite/src/channel":46,"vega-lite/src/stack":55}],18:[function(e,t,n){"use strict"},{}],19:[function(e,t,n){"use strict";function r(e,t,n){var r=i(e,t,n);return{score:r.score,features:[r]}}function i(e,t,r){var i=e.getEncodings();if(e.isAggregate()){var s=function(e){return e.type===o.Type.QUANTITATIVE&&!e.bin&&!e.aggregate&&!e.autoCount||e.type===o.Type.TEMPORAL&&!e.timeUnit};if(u.some(i,s))return{type:n.name,score:.1,feature:"Aggregate with raw continuous"};if(u.some(i,c.isDimension)){var l=u.some(i,function(e){return e.aggregate===a.AggregateOp.COUNT||e.autoCount===!0}),f=u.some(i,function(e){return!!e.bin});return l?{type:n.name,score:.8,feature:"Aggregate with count"}:f?{type:n.name,score:.7,feature:"Aggregate with bin but without count"}:{type:n.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:n.name,score:.3,feature:"Aggregate without dimension"}}return u.some(i,c.isMeasure)?{type:n.name,score:1,feature:"Raw with measure"}:{type:n.name,score:.2,feature:"Raw without measure"}}var a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/type"),u=e("../util"),c=e("../query/encoding");n.name="aggregationQuality",n.score=r},{"../query/encoding":13,"../util":28,"vega-lite/src/aggregate":43,"vega-lite/src/type":57}],20:[function(e,t,n){"use strict";var r,i=e("vega-lite/src/channel"),a=e("../../config"),o=e("../../query/shorthand"),u=e("../../util"),c=e("./effectiveness"),s=e("./type");!function(e){function t(){var t={},r={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:e.TERRIBLE,row:e.TERRIBLE,column:e.TERRIBLE,detail:2*e.TERRIBLE};[s.Q,s.T,s.TIMEUNIT_T].forEach(function(e){u.keys(r).forEach(function(i){t[n(e,i)]=r[i]})});var i=u.extend({},r,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[s.BIN_Q,s.TIMEUNIT_O,s.O].forEach(function(e){u.keys(i).forEach(function(r){t[n(e,r)]=i[r]})});var a={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return u.keys(a).forEach(function(e){t[n(s.N,e)]=a[e]}),t}function n(e,t){return e+"_"+t}function r(t,r,i){var a=t.getEncodings().reduce(function(e,t){var n=o.fieldDef(t);return(e[n]=e[n]||[]).push(t),e},{}),l=[];return u.forEach(a,function(t){var r=t.reduce(function(t,r){var i=s.getExtendedType(r),a=n(i,r.channel),o=c.getFeatureScore(e.TYPE_CHANNEL,a);return null===t||o.score>t.score?o:t},null);l.push(r)}),l}e.TYPE_CHANNEL="typeChannel",e.TERRIBLE=-10,e.init=t,e.featurize=n,e.getScore=r}(r=n.TypeChannelScore||(n.TypeChannelScore={}));var l;!function(e){function t(e){void 0===e&&(e={}),e=u.extend({},a.DEFAULT_QUERY_CONFIG,e);var t={},n=[{feature:s.BIN_Q,opt:"preferredBinAxis"},{feature:s.T,opt:"preferredTemporalAxis"},{feature:s.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:s.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:s.O,opt:"preferredOrdinalAxis"},{feature:s.N,opt:"preferredNominalAxis"}];return n.forEach(function(n){e[n.opt]===i.Channel.X?t[n.feature+"_"+i.Channel.Y]=-.01:e[n.opt]===i.Channel.Y&&(t[n.feature+"_"+i.Channel.X]=-.01)}),t}function n(e,t){return e+"_"+t}function r(t,r,i){return t.getEncodings().reduce(function(t,r){var i=s.getExtendedType(r),a=n(i,r.channel),o=c.getFeatureScore(e.PREFERRED_AXIS,a);return o&&t.push(o),t},[])}e.PREFERRED_AXIS="preferredAxis",e.init=t,e.featurize=n,e.getScore=r}(l=n.PreferredAxisScore||(n.PreferredAxisScore={}));var f;!function(e){function t(e){e=u.extend({},a.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===i.Channel.ROW?t[i.Channel.COLUMN]=-.01:e.preferredFacet===i.Channel.COLUMN&&(t[i.Channel.ROW]=-.01),t}function n(t,n,r){return t.getEncodings().reduce(function(t,n){var r=c.getFeatureScore(e.PREFERRED_FACET,n.channel);return r&&t.push(r),t},[])}e.PREFERRED_FACET="preferredFacet",e.init=t,e.getScore=n}(f=n.PreferredFacetScore||(n.PreferredFacetScore={}));var d;!function(e){function t(){return{bar_size:-2,tick_size:-2}}function n(t,n,r){var i=t.getMark();return t.getEncodings().reduce(function(t,n){var r=i+"_"+n.channel,a=c.getFeatureScore(e.MARK_CHANNEL,r);return a&&t.push(a),t},[])}e.MARK_CHANNEL="markChannel",e.init=t,e.getScore=n}(d=n.MarkChannelScore||(n.MarkChannelScore={}));var p;!function(e){function t(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}function n(t,n,r){return t.isAggregate()&&t.getEncodings().reduce(function(t,n){if(!n.aggregate&&!n.autoCount){var r=c.getFeatureScore(e.DIMENSION,n.channel+"");if(r.score>t.score)return r}return t},{type:e.DIMENSION,feature:"No Dimension",score:-5}),[]}e.DIMENSION="dimension",e.init=t,e.getScore=n}(p=n.DimensionScore||(n.DimensionScore={}))},{"../../config":1,"../../query/shorthand":16,"../../util":28,"./effectiveness":21,"./type":23,"vega-lite/src/channel":46}],21:[function(e,t,n){"use strict";function r(e,t){var r=n.FEATURE_INDEX[e][t];return void 0!==r?{score:r,type:e,feature:t}:null}function i(e){c.push(e),n.FEATURE_INDEX[e.type]=e.init()}function a(e,t,n){var r=c.reduce(function(r,i){var a=i.getScore(e,t,n);return r.concat(a)},[]);return{score:r.reduce(function(e,t){return e+t.score},0),features:r}}var o=e("./channel"),u=e("./mark");n.FEATURE_INDEX={};var c=[];n.getFeatureScore=r,n.addFeatureFactory=i,i({type:o.TypeChannelScore.TYPE_CHANNEL,init:o.TypeChannelScore.init,getScore:o.TypeChannelScore.getScore}),i({type:o.PreferredAxisScore.PREFERRED_AXIS,init:o.PreferredAxisScore.init,getScore:o.PreferredAxisScore.getScore}),i({type:o.PreferredFacetScore.PREFERRED_FACET,init:o.PreferredFacetScore.init,getScore:o.PreferredFacetScore.getScore}),i({type:o.MarkChannelScore.MARK_CHANNEL,init:o.MarkChannelScore.init,getScore:o.MarkChannelScore.getScore}),i({type:u.MarkScore.MARK_SCORE,init:u.MarkScore.init,getScore:u.MarkScore.getScore}),Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"./channel":20,"./mark":22}],22:[function(e,t,n){"use strict";var r,i=e("vega-lite/src/channel"),a=e("vega-lite/src/mark"),o=e("../../util"),u=e("./effectiveness"),c=e("./type");!function(e){function t(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function n(){var e=[c.Q,c.T],n=[c.BIN_Q,c.TIMEUNIT_O,c.O,c.N],r=n.concat([c.NONE]),i={};return e.forEach(function(n){e.forEach(function(e){var r={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(n,e,!0,a);i[o]=r});var a={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(a,function(r,a){var o=t(n,e,!1,a);i[o]=r})})}),e.forEach(function(e){r.forEach(function(n){var r={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!0,a);i[o]=r;var u=t(n,e,!0,a);i[u]=r})}),[c.TIMEUNIT_T].forEach(function(n){var r={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!0,a);i[o]=r;var u=t(n,e,!0,a);i[u]=r})}),[c.NONE,c.N,c.O].forEach(function(n){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r;var u=t(n,e,!1,a);i[u]=r})}),[c.BIN_Q].forEach(function(n){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r;var u=t(n,e,!1,a);i[u]=r})}),[c.TIMEUNIT_T,c.TIMEUNIT_O].forEach(function(n){var r={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r;var u=t(n,e,!1,a);i[u]=r})})}),[c.TIMEUNIT_T].forEach(function(e){[c.TIMEUNIT_T].forEach(function(n){var r={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!0,a);i[o]=r}),o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r})}),r.forEach(function(n){var r={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!0,a);i[o]=r}),o.forEach(r,function(r,a){var o=t(n,e,!0,a);i[o]=r}),o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r}),o.forEach(r,function(r,a){var o=t(n,e,!1,a);i[o]=r})})}),r.forEach(function(e){r.forEach(function(n){var r={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(r,function(r,a){var o=t(e,n,!0,a);i[o]=r}),o.forEach(r,function(r,a){var o=t(e,n,!1,a);i[o]=r})})}),i}function r(t,n,r){var o=t.getMark();o!==a.Mark.CIRCLE&&o!==a.Mark.SQUARE||(o=a.Mark.POINT);var s=t.getEncodingQueryByChannel(i.Channel.X),l=s?c.getExtendedType(s):c.NONE,f=t.getEncodingQueryByChannel(i.Channel.Y),d=f?c.getExtendedType(f):c.NONE,p=!t.isAggregate(),g=l+"_"+d+"_"+p+"_"+o,y=u.getFeatureScore(e.MARK_SCORE,g);return[y]}e.MARK_SCORE="markScore",e.featurize=t,e.init=n,e.getScore=r}(r=n.MarkScore||(n.MarkScore={}))},{"../../util":28,"./effectiveness":21,"./type":23,"vega-lite/src/channel":46,"vega-lite/src/mark":52}],23:[function(e,t,n){"use strict";function r(e){if(e.bin)return i.BIN_Q;if(e.timeUnit){var t=u.scaleType(e);return a.hasDiscreteDomain(t)?i.TIMEUNIT_O:i.TIMEUNIT_T}return e.type}var i,a=e("vega-lite/src/scale"),o=e("vega-lite/src/type"),u=e("../../query/encoding");!function(e){e[e.Q=o.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+o.Type.QUANTITATIVE]="BIN_Q",e[e.T=o.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+o.Type.ORDINAL]="TIMEUNIT_O",e[e.O=o.Type.ORDINAL]="O",e[e.N=o.Type.NOMINAL]="N",e[e.NONE="-"]="NONE"}(i=n.ExtendedType||(n.ExtendedType={})),n.Q=i.Q,n.BIN_Q=i.BIN_Q,n.T=i.T,n.TIMEUNIT_T=i.TIMEUNIT_T,n.TIMEUNIT_O=i.TIMEUNIT_O,n.O=i.O,n.N=i.N,n.NONE=i.NONE,n.getExtendedType=r},{"../../query/encoding":13,"vega-lite/src/scale":53,"vega-lite/src/type":57}],24:[function(e,t,n){"use strict";function r(e,t,n){var r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};for(var i=e.specQuery.encodings,a=t.fieldSchemas.length,o=[],u=0,c=1,s=r.length-1;s>=0;s--){var l=r[s],f=i[l].field,d=e.wildcardIndex.encodings[l].get("field"),p=t.fieldSchema(f).index,g=-p*c;u+=g,o.push({score:g,type:"fieldOrder",feature:"field "+d.name+" is "+f+" (#"+p+" in the schema)"}),c*=a}return{score:u,features:o}}n.name="fieldOrder",n.score=r},{}],25:[function(e,t,n){"use strict";function r(e,t){l[e]=t}function i(e){return l[e]}function a(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach(function(e){a(e,t,n,r+1)}),t.nest[r].orderGroupBy&&e.items.sort(u(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(o(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function o(e,t,n){return function(r,i){return e instanceof Array?c(e,r,i,t,n):c([e],r,i,t,n)}}function u(e,t,n){return function(r,i){var a=r.getTopSpecQueryModel(),o=i.getTopSpecQueryModel();return e instanceof Array?c(e,a,o,t,n):c([e],a,o,t,n)}}function c(e,t,n,r,i){for(var a=0,o=e;a<o.length;a++){var u=o[a],c=s(n,u,r,i).score-s(t,u,r,i).score;if(0!==c)return c}return 0}function s(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var a=i(t),o=a(e,n,r);return e.setRankingScore(t,o),o}n.effectiveness=e("./effectiveness/effectiveness"),n.aggregation=e("./aggregation"),n.fieldOrder=e("./fieldorder");var l={};n.register=r,n.get=i,n.rank=a,n.comparatorFactory=o,n.groupComparatorFactory=u,n.getScore=s,n.EFFECTIVENESS="effectiveness",r(n.EFFECTIVENESS,n.effectiveness["default"]),r(n.aggregation.name,n.aggregation.score),r(n.fieldOrder.name,n.fieldOrder.score)},{"./aggregation":19,"./effectiveness/effectiveness":21,"./fieldorder":24}],26:[function(e,t,n){"use strict";function r(e,t){var n=d({min:t.min,max:t.max,maxbins:e}),r=g.extend({},t);return r.unique=a(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function i(e,t){var n=g.extend({},t),r={};return g.keys(t.unique).forEach(function(n){var i,a="null"===n?null:new Date(n);i=null===a?null:isNaN(a.getTime())?"Invalid Date":(e===s.TimeUnit.DAY?a.getDay():s.convert(e,a)).toString(),r[i]=(r[i]||0)+t.unique[n]}),n.unique=r,n.distinct=g.keys(r).length,n}function a(e,t){var n={};for(var r in t){var i=void 0;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function o(e,t){return t.reduce(function(t,n){return e[n]?t+1:t},0)}var u=e("vega-lite/src/type"),c=e("vega-lite/src/bin"),s=e("vega-lite/src/timeunit"),l=e("datalib/src/stats"),f=e("datalib/src/import/type"),d=e("datalib/src/bins/bins"),p=e("./config"),g=e("./util"),y=function(){function e(e){this._fieldSchemas=e,this._fieldSchemaIndex=e.reduce(function(e,t){return e[t.field]=t,e},{})}return e.build=function(t,n){void 0===n&&(n={}),n=g.extend({},p.DEFAULT_QUERY_CONFIG,n);var a=l.summary(t),o=f.inferAll(t),c=a.map(function(e){var r,i=e.field,a=o[i],c=e.distinct;if(a===h.NUMBER)r=u.Type.QUANTITATIVE;else if(a===h.INTEGER)r=c<n.numberNominalLimit&&c/e.count<n.numberNominalProportion?u.Type.NOMINAL:u.Type.QUANTITATIVE;else if(a===h.DATE){r=u.Type.TEMPORAL,e.min=new Date(t[0][i]),
e.max=new Date(t[0][i]);for(var s=0,l=t;s<l.length;s++){var f=l[s],d=new Date(f[i]).getTime();d<e.min.getTime()&&(e.min=new Date(d)),d>e.max.getTime()&&(e.max=new Date(d))}}else r=u.Type.NOMINAL;return{field:i,type:r,primitiveType:a,stats:e,timeStats:{},binStats:{}}}),s={nominal:0,ordinal:1,temporal:2,quantitative:3};c.sort(function(e,t){return s[e.type]<s[t.type]?-1:s[e.type]>s[t.type]?1:e.field.localeCompare(t.field)}),c.forEach(function(e,t){return e.index=t});for(var d=0,y=c;d<y.length;d++){var E=y[d];if(E.type===u.Type.QUANTITATIVE)for(var m=0,v=n["enum"].binProps.maxbins;m<v.length;m++){var T=v[m];E.binStats[T]=r(T,E.stats)}else if(E.type===u.Type.TEMPORAL)for(var N=0,A=n["enum"].timeUnit;N<A.length;N++){var S=A[N];void 0!==S&&(E.timeStats[S]=i(S,E.stats))}}return new e(c)},e.prototype.fields=function(){return this._fieldSchemas.map(function(e){return e.field})},Object.defineProperty(e.prototype,"fieldSchemas",{get:function(){return this._fieldSchemas},enumerable:!0,configurable:!0}),e.prototype.fieldSchema=function(e){return this._fieldSchemaIndex[e]},e.prototype.primitiveType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].primitiveType:null},e.prototype.type=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null},e.prototype.cardinality=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var a=this._fieldSchemaIndex[e.field];if(e.aggregate||e.autoCount)return 1;if(e.bin){var u=void 0;u="boolean"==typeof e.bin?{maxbins:c.autoMaxBins(e.channel)}:e.bin;var l=u.maxbins;return a.binStats[l]||(a.binStats[l]=r(l,a.stats)),a.binStats[l].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case s.TimeUnit.SECONDS:return 60;case s.TimeUnit.MINUTES:return 60;case s.TimeUnit.HOURS:return 24;case s.TimeUnit.DAY:return 7;case s.TimeUnit.DATE:return 31;case s.TimeUnit.MONTH:return 12;case s.TimeUnit.QUARTER:return 4;case s.TimeUnit.MILLISECONDS:return 1e3}var f=e.timeUnit,d=a.timeStats;return d[f]||(d[f]=i(e.timeUnit,a.stats)),n?d[f].distinct-o(d[f].unique,["Invalid Date",null]):d[f].distinct}return a?n?a.stats.distinct-o(a.stats.unique,[NaN,null]):a.stats.distinct:null},e.prototype.timeUnitHasVariation=function(e){if(e.timeUnit){if(e.timeUnit===s.TimeUnit.DAY){var t=g.extend({},e,{timeUnit:s.TimeUnit.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}for(var n=e.timeUnit,r=0,i=s.SINGLE_TIMEUNITS;r<i.length;r++){var a=i[r];if(s.containsTimeUnit(n,a)){var o=g.extend({},e,{timeUnit:a});if(this.cardinality(o,!1,!0)<=1)return!1}}return!0}},e.prototype.domain=function(e){var t=this._fieldSchemaIndex[e.field],n=g.keys(t.stats.unique);return t.type===u.Type.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.primitiveType===h.DATE?[t.stats.min,t.stats.max]:t.primitiveType===h.INTEGER||t.primitiveType===h.NUMBER?(n=n.map(function(e){return+e}),n.sort(g.cmp)):n.map(function(e){return"null"===e?null:e}).sort(g.cmp)},e.prototype.stats=function(e){var t=this._fieldSchemaIndex[e.field];return t?t.stats:null},e}();n.Schema=y;var h;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATE="date"]="DATE"}(h=n.PrimitiveType||(n.PrimitiveType={}))},{"./config":1,"./util":28,"datalib/src/bins/bins":33,"datalib/src/import/type":35,"datalib/src/stats":36,"vega-lite/src/bin":45,"vega-lite/src/timeunit":56,"vega-lite/src/type":57}],27:[function(e,t,n){"use strict";function r(e,t,n){var r={};return e=e.map(function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=i(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=a(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=o(e,t,r,n)),e})}function i(e,t,n,r){[c.Channel.ROW,c.Channel.Y,c.Channel.COLUMN,c.Channel.X].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)});var i=n[c.Channel.Y];if(void 0!==i&&(n[c.Channel.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});var a=f.scaleType(i);i.scale&&(void 0===a||s.hasDiscreteDomain(a))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}var o=n[c.Channel.X];if(void 0!==o&&(n[c.Channel.COLUMN]||t.cardinality(o)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===o.scale&&(o.scale={});var u=f.scaleType(o);o.scale&&(void 0===u||s.hasDiscreteDomain(u))&&(o.scale.rangeStep||(o.scale.rangeStep=12))}return e}function a(e,t,n,r){n[c.Channel.COLOR]=e.getEncodingQueryByChannel(c.Channel.COLOR);var i=n[c.Channel.COLOR];return void 0!==i&&i.type===l.Type.NOMINAL&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.range=r.nominalColorScaleForHighCardinality.palette))),e}function o(e,t,n,r){if([c.Channel.COLUMN,c.Channel.X,c.Channel.Y].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)}),void 0===n[c.Channel.COLUMN]){var i=n[c.Channel.X],a=n[c.Channel.Y];void 0!==a&&a.field&&s.hasDiscreteDomain(f.scaleType(a))&&void 0!==i&&t.cardinality(a)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient=u.AxisOrient.TOP))}return e}var u=e("vega-lite/src/axis"),c=e("vega-lite/src/channel"),s=e("vega-lite/src/scale"),l=e("vega-lite/src/type"),f=e("./query/encoding");n.stylize=r,n.smallRangeStepForHighCardinalityOrFacet=i,n.nominalColorScaleForHighCardinality=a,n.xAxisOnTopForHighYCardinalityWithoutColumn=o},{"./query/encoding":13,"vega-lite/src/axis":44,"vega-lite/src/channel":46,"vega-lite/src/scale":53,"vega-lite/src/type":57}],28:[function(e,t,n){"use strict";function r(e,t){return e.indexOf(t)!==-1}function i(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function a(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function o(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function u(e,t){return e.map(function(e){return s.isArray(e)?u(e,t):t(e)})}function c(e,t){return e.filter(function(e){return!r(t,e)})}var s=e("datalib/src/util"),l=e("datalib/src/util");n.cmp=l.cmp,n.keys=l.keys,n.duplicate=l.duplicate,n.extend=l.extend,n.isObject=l.isObject,n.isArray=l.isArray,n.isBoolean=l.isBoolean,n.toMap=l.toMap,n.contains=r,n.every=i,n.forEach=a,n.some=o,n.nestedMap=u,n.without=c},{"datalib/src/util":38}],29:[function(e,t,n){"use strict";function r(e){return i(e)||void 0!==e&&(!!e["enum"]||!!e.name)&&!l.isArray(e)}function i(e){return e===n.SHORT_WILDCARD}function a(e,t,r){return l.extend({},{name:t,"enum":r},e===n.SHORT_WILDCARD?{}:e)}function o(e){for(var t={},n={},r=function(e){for(var r=[0],i=0;i<e.length;i++)e.charAt(i).toUpperCase()===e.charAt(i)&&r.push(i);var a=r.map(function(t){return e.charAt(t)}).join("").toLowerCase();if(!n[a])return t[e]=a,n[a]=!0,"continue";if(r[r.length-1]!==e.length-1&&(a=r.concat([e.length-1]).map(function(t){return e.charAt(t)}).join("").toLowerCase(),!n[a]))return t[e]=a,n[a]=!0,"continue";for(var i=1;!t[e];i++){var o=a+"_"+i;if(!n[o]){t[e]=o,n[o]=!0;break}}},i=0,a=e;i<a.length;i++){var o=a[i];r(o)}return t}function u(e){if(s.isEncodingNestedProp(e))return n.DEFAULT_NAME[e.parent]+"-"+n.DEFAULT_NAME[e.parent+"Props"][e.child];if(n.DEFAULT_NAME[e])return n.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)}function c(e,t,n){if("field"===e||s.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fields();var r;if(r=s.isEncodingNestedProp(e)?n["enum"][e.parent+"Props"][e.child]:n["enum"][e],void 0!==r)return r;throw new Error("No default enumValues for "+e)}var s=e("./property"),l=e("./util"),f=e("vega-lite/src/aggregate"),d=e("vega-lite/src/channel"),p=e("vega-lite/src/mark"),g=e("vega-lite/src/scale"),y=e("vega-lite/src/sort"),h=e("vega-lite/src/timeunit"),E=e("vega-lite/src/type");n.SHORT_WILDCARD="?",n.isWildcard=r,n.isShortWildcard=i,n.initWildcard=a,n.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",scale:"s",axis:"ax",legend:"l",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:o(s.SCALE_CHILD_PROPS),axisProps:o(s.AXIS_CHILD_PROPS),legendProps:o(s.LEGEND_CHILD_PROPS)},n.getDefaultName=u;var m=[!1,!0],v={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]]},T={field:[void 0],op:[f.AggregateOp.MIN,f.AggregateOp.MEAN],order:[y.SortOrder.ASCENDING,y.SortOrder.DESCENDING]},N={type:[void 0,g.ScaleType.LOG],domain:[void 0],exponent:[1,2],clamp:m,nice:m,round:m,useRawDomain:m,zero:m,range:[void 0],rangeStep:[17,21]},A={axisColor:[void 0],axisWidth:[void 0],zindex:[1,0],offset:[void 0],orient:[void 0],shortTimeLabels:m,subdivide:[void 0],values:[void 0],grid:m,gridColor:[void 0],gridDash:[void 0],gridOpacity:[void 0],gridWidth:[void 0],format:[void 0],labels:m,labelAngle:[void 0],labelMaxLength:[void 0],ticks:m,tickColor:[void 0],tickLabelColor:[void 0],tickLabelFont:[void 0],tickLabelFontSize:[void 0],tickPadding:[void 0],tickSize:[void 0],tickSizeMajor:[void 0],tickSizeMinor:[void 0],tickSizeEnd:[void 0],tickWidth:[void 0],title:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontWeight:[void 0],titleFontSize:[void 0],titleOffset:[void 0],titleMaxLength:[void 0]},S={orient:["left","right"],offset:[void 0],format:[void 0],shortTimeLabels:m,values:[void 0],labelAlign:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelFont:[void 0],labelFontSize:[void 0],symbolColor:[void 0],symbolShape:[void 0],symbolSize:[void 0],symbolStrokeWidth:[void 0],title:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontWeight:[void 0]};n.DEFAULT_ENUM_INDEX={mark:[p.Mark.POINT,p.Mark.BAR,p.Mark.LINE,p.Mark.AREA,p.Mark.TICK],channel:[d.X,d.Y,d.ROW,d.COLUMN,d.SIZE,d.COLOR],aggregate:[void 0,f.AggregateOp.MEAN],autoCount:m,bin:m,hasFn:m,timeUnit:[void 0,h.TimeUnit.YEAR,h.TimeUnit.MONTH,h.TimeUnit.MINUTES,h.TimeUnit.SECONDS],field:[void 0],type:[E.Type.NOMINAL,E.Type.ORDINAL,E.Type.QUANTITATIVE,E.Type.TEMPORAL],sort:[y.SortOrder.ASCENDING,y.SortOrder.DESCENDING],scale:[!0],axis:m,legend:m,binProps:v,sortProps:T,scaleProps:N,axisProps:A,legendProps:S},n.getDefaultEnumValues=c},{"./property":11,"./util":28,"vega-lite/src/aggregate":43,"vega-lite/src/channel":46,"vega-lite/src/mark":52,"vega-lite/src/scale":53,"vega-lite/src/sort":54,"vega-lite/src/timeunit":56,"vega-lite/src/type":57}],30:[function(e,t,n){"use strict";var r=e("./property"),i=e("./propindex"),a=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new i.PropIndex}return e.prototype.setEncodingProperty=function(e,t,n){var r=this._encodings,a=r[e]=r[e]||new i.PropIndex;a.set(t,n);var o=this._encodingIndicesByProperty;return o.set(t,o.get(t)||[]),o.get(t).push(e),this},e.prototype.hasEncodingProperty=function(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)},e.prototype.hasProperty=function(e){if(r.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===this.encodingIndicesByProperty.size()},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();n.WildcardIndex=a},{"./property":11,"./propindex":12}],31:[function(e,t,n){},{}],32:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,o){function u(t){return e(t=new Date((+t))),t}return u.floor=u,u.round=function(t){var r=new Date((+t)),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date((+e)),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var a=[];if(t=new Date(t-1),r=new Date((+r)),i=null==i?1:Math.floor(i),!(t<r&&i>0))return a;for(n(t,1),e(t),t<r&&a.push(new Date((+t)));n(t,i),e(t),t<r;)a.push(new Date((+t)));return a},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),a.setTime(+n),e(i),e(a),Math.floor(r(i,a))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(o?function(t){return o(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,a=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):o:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),s=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),f=n(0),d=n(1),p=n(2),g=n(3),y=n(4),h=n(5),E=n(6),m=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),v=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),T=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),N=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),A=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),S=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),C=r(0),O=r(1),I=r(2),P=r(3),R=r(4),M=r(5),D=r(6),U=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),_=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),L=o.range,b=u.range,w=c.range,x=s.range,k=l.range,F=f.range,H=d.range,G=p.range,W=g.range,B=y.range,Y=h.range,q=E.range,Q=f.range,V=m.range,j=v.range,z=o,X=L,K=T.range,$=N.range,J=A.range,Z=S.range,ee=C.range,te=O.range,ne=I.range,re=P.range,ie=R.range,ae=M.range,oe=D.range,ue=C.range,ce=U.range,se=_.range,le="0.1.1";e.version=le,e.milliseconds=L,e.seconds=b,e.minutes=w,e.hours=x,e.days=k,e.sundays=F,e.mondays=H,e.tuesdays=G,e.wednesdays=W,e.thursdays=B,e.fridays=Y,e.saturdays=q,e.weeks=Q,e.months=V,e.years=j,e.utcMillisecond=z,e.utcMilliseconds=X,e.utcSeconds=K,e.utcMinutes=$,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=ae,e.utcSaturdays=oe,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=o,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=f,e.monday=d,e.tuesday=p,e.wednesday=g,e.thursday=y,e.friday=h,e.saturday=E,e.week=f,e.month=m,e.year=v,e.utcSecond=T,e.utcMinute=N,e.utcHour=A,e.utcDay=S,e.utcSunday=C,e.utcMonday=O,e.utcTuesday=I,e.utcWednesday=P,e.utcThursday=R,e.utcFriday=M,e.utcSaturday=D,e.utcWeek=C,e.utcMonth=U,e.utcYear=_,e.interval=t})},{}],33:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,u,c,s,l,f=e.maxbins||15,d=e.base||10,p=Math.log(d),g=e.div||[5,2],y=e.min,h=e.max,E=h-y;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,E/f,0,e.steps.length))];else{for(n=Math.ceil(Math.log(f)/p),r=e.minstep||0,t=Math.max(r,Math.pow(d,Math.round(Math.log(E)/p)-n));Math.ceil(E/t)>f;)t*=d;for(s=0;s<g.length;++s)c=t/g[s],c>=r&&E/c<=f&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/p)+1,l=Math.pow(d,-u-1),y=Math.min(y,Math.floor(y/t+l)*t),h=Math.ceil(h/t)*t,{start:y,stop:h,step:t,unit:{precision:u},value:a,index:o}}function i(e,t,n,r){for(;n<r;){var i=n+r>>>1;s.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e){return this.step*Math.floor(e/this.step+f)}function o(e){return Math.floor((e-this.start)/this.step+f)}function u(e){return this.unit.date(a.call(this,e))}function c(e){return o.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),f=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,a=e.maxbins||20,o=e.minbins||4,s=+i-+n,f=e.unit?t[e.unit]:t.find(s,o,a),d=r({min:null!=f.min?f.min:f.unit(n),max:null!=f.max?f.max:f.unit(i),maxbins:a,minstep:f.minstep,steps:f.step});return d.unit=f,d.index=c,e.raw||(d.value=u),d},t.exports=r},{"../time":37,"../util":38}],34:[function(e,t,n){var r=e("./util"),i=t.exports;i.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(n<0)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,r=function(){return e+n*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=t?1/n:0},r.cdf=function(r){return r<e?0:r>t?1:(r-e)/n},r.icdf=function(t){return t>=0&&t<=1?e+t*n:NaN},r},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,r=function(){return e+Math.floor(n*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<t?1/n:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=t?1:(i-e+1)/n},r.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*n):NaN},r},i.random.normal=function(e,t){e=e||0,t=t||1;var n,r=function(){var r,i,a=0,o=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,o=2*Math.random()-1,r=a*a+o*o;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+o*i*t,e+a*i*t};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},r.cdf=function(n){var r,i=(n-e)/t,a=Math.abs(i);if(a>37)r=0;else{var o,u=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,r=u*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,r/=o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,r=u/o/2.506628274631)}return i>0?1-r:r},r.icdf=function(n){if(n<=0||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),a=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,o=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(a*a-o)-a);return e+t*Math.SQRT2*u},r},i.random.bootstrap=function(e,t){var n=e.filter(r.isValid),a=n.length,o=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*a)]+(o?o():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":38}],35:[function(e,t,n){function r(e,t){return t?void(e[f]=t):e&&e[f]||null}function i(e){return l.keys(e)}function a(e){return"["+e+"]"}function o(e,t){e=l.array(e),t=l.$(t);var n,r,i;if(e[f]&&(n=t(e[f]),l.isString(n)))return n;for(r=0,i=e.length;!l.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function u(e,t){if(e.length){var n=t?l.identity:(t=i(e[0]),a);return t.reduce(function(t,r){return t[r]=o(e,n(r)),t},{})}}function c(e,t){e=l.array(e),t=l.$(t);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<a.length;++r)l.isValid(i)&&!p[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function s(e,t){var n=t?l.identity:(t=i(e[0]),a);return t.reduce(function(t,r){return t[r]=c(e,n(r)),t},{})}var l=e("../util"),f="__types__",d={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(e){return null==e||""===e?null:e+""}},p={"boolean":function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};o.annotation=r,o.all=u,o.infer=c,o.inferAll=s,o.parsers=d,t.exports=o},{"../util":38}],36:[function(e,t,n){function r(e,t,n){var r=e&&e.nullh||0,i=c.random.normal(0,1),a=s.mean(t,n),o=s.stdev(t,n)/Math.sqrt(s.count.valid(t,n));if(0===o)return a-r===0?1:0;var u=(a-r)/o;return 2*i.cdf(-Math.abs(u))}function i(e,t,n,r){var i,a=r?t.map(o.$(n)):t,u=r?t.map(o.$(r)):n,c=s.count(a),l=s.count(u),f=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;i<c;++i)o.isValid(a[i])&&o.isValid(u[i])&&f.push(a[i]-u[i]);return s.z.test(f,e&&e.nullh||0)}function a(e,t,n,r){var i=r?t.map(o.$(n)):t,a=r?t.map(o.$(r)):n,u=s.count.valid(i),l=s.count.valid(a),f=c.random.normal(0,1),d=s.mean(i)-s.mean(a)-(e&&e.nullh||0),p=Math.sqrt(s.variance(i)/u+s.variance(a)/l);if(0===p)return 0===d?1:0;var g=d/p;return 2*f.cdf(-Math.abs(g))}var o=e("./util"),u=e("./import/type"),c=e("./generate"),s=t.exports;s.unique=function(e,t,n){t=o.$(t),n=n||[];var r,i,a,u={};for(i=0,a=e.length;i<a;++i)r=t?t(e[i]):e[i],r in u||(u[r]=1,n.push(r));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=o.$(t);var n,r,i,a=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o.isValid(n)&&(a+=1);return a},s.count.missing=function(e,t){t=o.$(t);var n,r,i,a=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],null==n&&(a+=1);return a},s.count.distinct=function(e,t){t=o.$(t);var n,r,i,a={},u=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],n in a||(a[n]=1,u+=1);return u},s.count.map=function(e,t){t=o.$(t);var n,r,i,a={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],a[n]=n in a?a[n]+1:1;return a},s.median=function(e,t){return t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=o.identity),t=o.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),a=+t(e[i-1]),u=r-i;return u?a+u*(t(e[i])-a):a},s.sum=function(e,t){t=o.$(t);for(var n,r=0,i=0,a=e.length;i<a;++i)n=t?t(e[i]):e[i],o.isValid(n)&&(r+=n);return r},s.mean=function(e,t){t=o.$(t);var n,r,i,a,u,c=0;for(r=0,a=0,i=e.length;r<i;++r)u=t?t(e[r]):e[r],o.isValid(u)&&(n=u-c,c+=n/++a);return c},s.mean.geometric=function(e,t){t=o.$(t);var n,r,i,a,u=1;for(a=0,n=0,r=e.length;a<r;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");u*=i,++n}return u=n>0?Math.pow(u,1/n):0},s.mean.harmonic=function(e,t){t=o.$(t);var n,r,i,a,u=0;for(a=0,n=0,r=e.length;a<r;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(u+=1/i,++n);return n/u},s.variance=function(e,t){if(t=o.$(t),!o.isArray(e)||e.length<2)return 0;var n,r,i,a,u=0,c=0;for(r=0,i=0;r<e.length;++r)a=t?t(e[r]):e[r],o.isValid(a)&&(n=a-u,u+=n/++i,c+=n*(a-u));return c/=i-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=o.$(t);var n,r,i,a,u=e.length;for(a=0;a<u;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){n=r=i;break}for(;a<u;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},s.extent.index=function(e,t){t=o.$(t);var n,r,i,a,u=-1,c=-1,s=e.length;for(a=0;a<s;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){n=r=i,u=c=a;break}for(;a<s;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(i<n&&(n=i,u=a),i>r&&(r=i,c=a));return[u,c]},s.dot=function(e,t,n){var r,i,a=0;if(n)for(t=o.$(t),n=o.$(n),r=0;r<e.length;++r)i=t(e[r])*n(e[r]),i===i&&(a+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*t[r],i===i&&(a+=i)}return a},s.dist=function(e,t,n,r){var i,a,u=o.isFunction(n)||o.isString(n),c=e,s=u?e:t,l=u?r:n,f=2===l||null==l,d=e.length,p=0;for(u&&(t=o.$(t),n=o.$(n)),a=0;a<d;++a)i=u?t(c[a])-n(s[a]):c[a]-s[a],p+=f?i*i:Math.pow(Math.abs(i),l);return f?Math.sqrt(p):Math.pow(p,1/l)},s.cohensd=function(e,t,n){var r=n?e.map(o.$(t)):e,i=n?e.map(o.$(n)):t,a=s.mean(r),u=s.mean(i),c=s.count.valid(r),l=s.count.valid(i);if(c+l-2<=0)return 0;var f=s.variance(r),d=s.variance(i),p=Math.sqrt(((c-1)*f+(l-1)*d)/(c+l-2));return 0===p?0:(a-u)/p},s.covariance=function(e,t,n){var r,i,a,u,c,l=n?e.map(o.$(t)):e,f=n?e.map(o.$(n)):t,d=l.length,p=s.mean(l),g=s.mean(f),y=0,h=0;if(d!==f.length)throw Error("Input lengths must match.");for(r=0;r<d;++r)if(i=l[r],u=o.isValid(i),a=f[r],c=o.isValid(a),u&&c)y+=(i-p)*(a-g),++h;else if(u||c)throw Error("Valid values must align.");return y/(h-1)},s.rank=function(e,t){t=o.$(t)||o.identity;var n,r,i,a=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(o.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(n=0;n<u;++n){if(r=a[n].val,s<0&&l===r)s=n-1;else if(s>-1&&l!==r){for(i=1+(n-1+s)/2;s<n;++s)c[a[s].idx]=i;s=-1}c[a[n].idx]=n+1,l=r}if(s>-1)for(i=1+(u-1+s)/2;s<u;++s)c[a[s].idx]=i;return c},s.cor=function(e,t,n){var r=n;n=r?e.map(o.$(n)):t,t=r?e.map(o.$(t)):e;var i=s.dot(t,n),a=s.mean(t),u=s.mean(n),c=s.stdev(t),l=s.stdev(n),f=e.length;return(i-f*a*u)/((f-1)*c*l)},s.cor.rank=function(e,t,n){var r,i,a,o=n?s.rank(e,t):s.rank(e),u=n?s.rank(e,n):s.rank(t),c=e.length;for(r=0,i=0;r<c;++r)a=o[r]-u[r],i+=a*a;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,t,n){var r,i,a,u,c=n?e.map(o.$(t)):e,l=n?e.map(o.$(n)):t,f=s.dist.mat(c),d=s.dist.mat(l),p=f.length;for(r=0,i=0,a=0,u=0;r<p;++r)i+=f[r]*f[r],a+=d[r]*d[r],u+=f[r]*d[r];return Math.sqrt(u/Math.sqrt(i*a))},s.linearRegression=function(e,t,n){var r,i,a=n?e.map(o.$(t)):e,u=n?e.map(o.$(n)):t,c=a.length,l=s.covariance(a,u),f=s.stdev(a),d=s.stdev(u),p=l/(f*f),g=s.mean(u)-p*s.mean(a),y={slope:p,intercept:g,R:l/(f*d),rss:0};for(i=0;i<c;++i)o.isValid(a[i])&&o.isValid(u[i])&&(r=p*a[i]+g-u[i],y.rss+=r*r);return y},s.bootstrap={},s.bootstrap.ci=function(e,t,n,r,i){var a,u,l,f,d,p,g;for(o.isFunction(t)||o.isString(t)?(a=e.map(o.$(t)),u=n,l=r,f=i):(a=e,u=t,l=n,f=r),u=u?+u:1e3,l=l||.05,d=c.random.bootstrap(a,f),g=0,p=Array(u);g<u;++g)p[g]=s.mean(d.samples(a.length));return p.sort(o.numcmp),[s.quantile(p,l/2),s.quantile(p,1-l/2)]},s.z={},s.z.ci=function(e,t,n){var r=e,i=t;(o.isFunction(t)||o.isString(t))&&(r=e.map(o.$(t)),i=n),i=i||.05;var a=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(r),l=s.stdev(r)/Math.sqrt(s.count.valid(r));return[u-a*l,u+a*l]},s.z.test=function(e,t,n,u){return o.isFunction(n)||o.isString(n)?(u&&u.paired?i:a)(u,e,t,n):o.isArray(t)?(n&&n.paired?i:a)(n,e,t):o.isFunction(t)||o.isString(t)?r(n,e,t):r(t,e)},s.dist.mat=function(e){var t,n,r,i=e.length,a=i*i,o=Array(a),u=c.zeros(i),s=0;for(n=0;n<i;++n)for(o[n*i+n]=0,r=n+1;r<i;++r)o[n*i+r]=t=Math.abs(e[n]-e[r]),o[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)s+=u[n],u[n]/=i;for(s/=a,n=0;n<i;++n)for(r=n;r<i;++r)o[n*i+r]+=s-u[n]-u[r],o[r*i+n]=o[n*i+r];return o},s.entropy=function(e,t){t=o.$(t);var n,r,i=0,a=0,u=e.length;for(n=0;n<u;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<u;++n)r=(t?t(e[n]):e[n])/i,r&&(a+=r*Math.log(r));return-a/Math.LN2},s.mutual=function(e,t,n,r){var i,a,u,c=r?e.map(o.$(t)):e,s=r?e.map(o.$(n)):t,l=r?e.map(o.$(r)):n,f={},d={},p=l.length,g=0,y=0,h=0;for(u=0;u<p;++u)f[c[u]]=0,d[s[u]]=0;for(u=0;u<p;++u)f[c[u]]+=l[u],d[s[u]]+=l[u],g+=l[u];for(a=1/(g*Math.LN2),u=0;u<p;++u)0!==l[u]&&(i=g*l[u]/(f[c[u]]*d[s[u]]),y+=l[u]*a*Math.log(i),h+=l[u]*a*Math.log(l[u]/g));return[y,1+y/h]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,r,i,a,c,l=0,f=0,d=0,p=0,g=null,y=null,h=0,E=[],m={};for(i=0;i<e.length;++i)a=t?t(e[i]):e[i],m[a]=a in m?m[a]+1:(p+=1,1),null==a?++d:o.isValid(a)&&(c="string"==typeof a?a.length:a,(null===g||c<g)&&(g=c),(null===y||c>y)&&(y=c),n=c-l,l+=n/++f,h+=n*(c-l),E.push(c));return h/=f-1,r=Math.sqrt(h),E.sort(o.cmp),{type:u(e,t),unique:m,count:e.length,valid:f,missing:d,distinct:p,min:g,max:y,mean:l,stdev:r,median:a=s.quantile(E,.5),q1:s.quantile(E,.25),q3:s.quantile(E,.75),modeskew:0===r?0:(l-a)/r}},s.summary=function(e,t){t=t||o.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,o.$(t));return n.field=t,n});return n.__summary__=!0,n}},{"./generate":34,"./import/type":35,"./util":38}],37:[function(e,t,n){function r(e){return s.setTime(+e),s}function i(e,t,n,r,i,a){var o={type:e,date:t,unit:n};return r?o.step=r:o.minstep=1,null!=i&&(o.min=i),null!=a&&(o.max=a),o}function a(e,t,n,r,a,o){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,a,o)}function o(e,t,n,r){var i,a,o,u=g[0];for(i=1,a=g.length;i<a;++i)if(u=g[i],t>u[0]){if(o=t/u[0],o>r)return e[g[i-1][1]];if(o>=n)return e[u[1]]}return e[g[a-1][1]]}function u(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return o(e,t,n,r)},r}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),f=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),d=[a("second",c.second,l),a("minute",c.minute,l),a("hour",c.hour,l),a("day",c.day,l,[1,7]),a("month",c.month,l,[1,3,6]),a("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[a("second",c.utcSecond,f),a("minute",c.utcMinute,f),a("hour",c.utcHour,f),a("day",c.utcDay,f,[1,7]),a("month",c.utcMonth,f,[1,3,6]),a("year",c.utcYear,f),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){
return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],g=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(d),t.exports.utc=u(p)},{"d3-time":32}],38:[function(e,t,n){(function(e){function n(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function r(e,t,n){var r=0,i=e.split(c);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,a="__name__";i.namedfunc=function(e,t){return t[a]=e,t},i.name=function(e){return null==e?null:e[a]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var o=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===o.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===o.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===o.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===o.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},i.isDate=function(e){return"[object Date]"===o.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"!==e&&!!e},i.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var r=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(r,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,r){var a,o,u,c;for(a=0,o=e.length;a<o;++a)if(u=e[a],c=i.cmp(u(n),u(r)))return c*t[a];return 0}},i.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var a=t(e),o=t(i);return a<o?-1:a>o?1:r[n(e)]-r[n(i)]}),e},i.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},i.pad=function(e,t,r,i){i=i||" ";var a=t-e.length;if(a<=0)return e;switch(r){case"left":return n(a,i)+e;case"middle":case"center":return n(Math.floor(a/2),i)+e+n(Math.ceil(a/2),i);default:return e+n(a,i)}},i.truncate=function(e,t,n,i,a){var o=e.length;if(o<=t)return e;a=void 0!==a?String(a):"…";var u=Math.max(0,t-a.length);switch(n){case"left":return a+(i?r(e,u,1):e.slice(o-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+a+(i?r(e,s,1):e.slice(o-s));default:return(i?r(e,u):e.slice(0,u))+a}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:31}],39:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},a={key:r,value:t[r]};return e(i,a)}}}(t.cmp),s=[];return function l(e,t,f,d){var p=n?"\n"+new Array(d+1).join(n):"",g=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),f=u.call(e,t,f),void 0!==f){if("object"!=typeof f||null===f)return r.stringify(f);if(i(f)){for(var y=[],h=0;h<f.length;h++){var E=l(f,h,f[h],d+1)||r.stringify(null);y.push(p+n+E)}return"["+y.join(",")+p+"]"}if(s.indexOf(f)!==-1){if(o)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(f);for(var m=a(f).sort(c&&c(f)),y=[],h=0;h<m.length;h++){var t=m[h],v=l(f,t,f[t],d+1);if(v){var T=r.stringify(t)+g+v;y.push(p+n+T)}}return s.splice(s.indexOf(f),1),"{"+y.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:40}],40:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":41,"./lib/stringify":42}],41:[function(e,t,n){var r,i,a,o,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},c=function(e){throw{name:"SyntaxError",message:e,at:r,text:a}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=a.charAt(r),r+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",s("-"));i>="0"&&i<="9";)t+=i,s();if("."===i)for(t+=".";s()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,s(),"-"!==i&&"+"!==i||(t+=i,s());i>="0"&&i<="9";)t+=i,s();return e=+t,isFinite(e)?e:void c("Bad number")},f=function(){var e,t,n,r="";if('"'===i)for(;s();){if('"'===i)return s(),r;if("\\"===i)if(s(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(s(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}c("Bad string")},d=function(){for(;i&&i<=" ";)s()},p=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},g=function(){var e=[];if("["===i){if(s("["),d(),"]"===i)return s("]"),e;for(;i;){if(e.push(o()),d(),"]"===i)return s("]"),e;s(","),d()}}c("Bad array")},y=function(){var e,t={};if("{"===i){if(s("{"),d(),"}"===i)return s("}"),t;for(;i;){if(e=f(),d(),s(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===i)return s("}"),t;s(","),d()}}c("Bad object")};o=function(){switch(d(),i){case"{":return y();case"[":return g();case'"':return f();case"-":return l();default:return i>="0"&&i<="9"?l():p()}},t.exports=function(e,t){var n;return a=e,r=0,i=" ",n=o(),d(),i&&c("Syntax error"),"function"==typeof t?function u(e,n){var r,i,a=e[n];if(a&&"object"==typeof a)for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=u(a,r),void 0!==i?a[r]=i:delete a[r]);return t.call(e,n,a)}({"":n},""):n}},{}],42:[function(e,t,n){function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,c,s,l,f,d=a,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof u&&(p=u.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,n=0;n<l;n+=1)f[n]=i(n,p)||"null";return s=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,s}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)c=u[n],"string"==typeof c&&(s=i(c,p),s&&f.push(r(c)+(a?": ":":")+s));else for(c in p)Object.prototype.hasOwnProperty.call(p,c)&&(s=i(c,p),s&&f.push(r(c)+(a?": ":":")+s));return s=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,s}}var a,o,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(a="",o="","number"==typeof n)for(r=0;r<n;r+=1)o+=" ";else"string"==typeof n&&(o=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],43:[function(e,t,n){"use strict";var r;!function(e){e.VALUES="values",e.COUNT="count",e.VALID="valid",e.MISSING="missing",e.DISTINCT="distinct",e.SUM="sum",e.MEAN="mean",e.AVERAGE="average",e.VARIANCE="variance",e.VARIANCEP="variancep",e.STDEV="stdev",e.STDEVP="stdevp",e.MEDIAN="median",e.Q1="q1",e.Q3="q3",e.MODESKEW="modeskew",e.MIN="min",e.MAX="max",e.ARGMIN="argmin",e.ARGMAX="argmax"}(r=n.AggregateOp||(n.AggregateOp={})),n.AGGREGATE_OPS=[r.VALUES,r.COUNT,r.VALID,r.MISSING,r.DISTINCT,r.SUM,r.MEAN,r.AVERAGE,r.VARIANCE,r.VARIANCEP,r.STDEV,r.STDEVP,r.MEDIAN,r.Q1,r.Q3,r.MODESKEW,r.MIN,r.MAX,r.ARGMIN,r.ARGMAX],n.SUM_OPS=[r.COUNT,r.SUM,r.DISTINCT,r.VALID,r.MISSING],n.SHARED_DOMAIN_OPS=[r.MEAN,r.AVERAGE,r.MEDIAN,r.Q1,r.Q3,r.MIN,r.MAX]},{}],44:[function(e,t,n){"use strict";var r;!function(e){e.TOP="top",e.RIGHT="right",e.LEFT="left",e.BOTTOM="bottom"}(r=n.AxisOrient||(n.AxisOrient={})),n.defaultAxisConfig={labelMaxLength:25},n.defaultFacetAxisConfig={axisWidth:0,domain:!1,grid:!1,ticks:!1}},{}],45:[function(e,t,n){"use strict";function r(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.SHAPE:return 6;default:return 10}}var i=e("./channel");n.autoMaxBins=r},{"./channel":46}],46:[function(e,t,n){"use strict";function r(e,t){return t in i(e)}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.OPACITY:case n.ORDER:case n.DETAIL:return{measure:!0,dimension:!0};case n.ROW:case n.COLUMN:case n.SHAPE:return{measure:!1,dimension:!0};case n.X2:case n.Y2:case n.SIZE:case n.TEXT:return{measure:!0,dimension:!1}}throw new Error("Invalid encoding channel "+e)}function o(e){return!l.contains([n.DETAIL,n.TEXT,n.ORDER],e)}function u(e,t){switch(e){case"row":case"column":return"band"===t;case"x":case"y":case"size":case"opacity":return t in f;case"color":return"band"!==t;case"shape":return"ordinal"===t}return!1}var c,s=e("./scale"),l=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail"}(c=n.Channel||(n.Channel={})),n.X=c.X,n.Y=c.Y,n.X2=c.X2,n.Y2=c.Y2,n.ROW=c.ROW,n.COLUMN=c.COLUMN,n.SHAPE=c.SHAPE,n.SIZE=c.SIZE,n.COLOR=c.COLOR,n.TEXT=c.TEXT,n.DETAIL=c.DETAIL,n.ORDER=c.ORDER,n.OPACITY=c.OPACITY,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=r,n.getSupportedMark=i,n.getSupportedRole=a,n.hasScale=o;var f=l.toSet(l.without(s.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=u},{"./scale":53,"./util":58}],47:[function(e,t,n){"use strict";function r(e,t,n,r,a,o,u,l){if(!s.hasScale(n))return null;if(void 0!==e){if(s.supportScaleType(n,e))return e;var f=i(t,n,r,a,o,u,l);return c.warn(c.message.scaleTypeNotWorkWithChannel(n,e,f)),f}return i(t,n,r,a,o,u,l)}function i(e,t,n,r,i,o,s){if(f.contains(["row","column"],t))return l.ScaleType.BAND;switch(e){case"nominal":return"color"===t||"discrete"===u(t)?l.ScaleType.ORDINAL:a(t,r,i,o,s);case"ordinal":return"color"===t?l.ScaleType.ORDINAL:"discrete"===u(t)?(c.warn(c.message.discreteChannelCannotEncode(t,"ordinal")),l.ScaleType.ORDINAL):a(t,r,i,o,s);case"temporal":if("color"===t)return"sequential";if("discrete"===u(t))return c.warn(c.message.discreteChannelCannotEncode(t,"temporal")),l.ScaleType.ORDINAL;switch(n){case"hours":case"day":case"month":case"quarter":return a(t,r,i,o,s)}return l.ScaleType.TIME;case"quantitative":return"color"===t?"sequential":"discrete"===u(t)?(c.warn(c.message.discreteChannelCannotEncode(t,"quantitative")),l.ScaleType.ORDINAL):l.ScaleType.LINEAR}throw new Error(c.message.invalidFieldType(e))}function a(e,t,n,r,i){if(f.contains(["x","y"],e)){if("rect"===t)return l.ScaleType.BAND;if("bar"===t)return o(n,r,i)?l.ScaleType.POINT:l.ScaleType.BAND}return l.ScaleType.POINT}function o(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}function u(e){switch(e){case"x":case"y":case"row":case"column":case"size":case"opacity":return"continuous";case"shape":return"discrete";case"color":return"flexible";case"x2":case"y2":case"detail":case"text":case"order":return}throw new Error("getSupportedRole not implemented for"+e)}var c=e("../../log"),s=e("../../channel"),l=e("../../scale"),f=e("../../util");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,n.channelRangeType=u},{"../../channel":46,"../../log":51,"../../scale":53,"../../util":58}],48:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(s.isNumber(e))return e>4&&l.warn(l.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(l.message.invalidTimeUnit("quarter",e))}function a(e){if(s.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),a=n.SHORT_MONTHS.indexOf(i);if(a!==-1)return a+"";throw new Error(l.message.invalidTimeUnit("month",e))}function o(e){if(s.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),a=n.SHORT_DAYS.indexOf(i);if(a!==-1)return a+"";throw new Error(l.message.invalidTimeUnit("day",e))}function u(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(s.keys(e).length>1)l.warn(l.message.droppedDay(e)),e=s.duplicate(e),delete e.day;else{n.setFullYear(f);var r=t?o(e.day):e.day;n.setDate(+r+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.setMonth(3*+u)}if(void 0!==e.month){var c=t?a(e.month):e.month;n.setMonth(+c)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function c(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&s.keys(e).length>1&&(l.warn(l.message.droppedDay(e)),e=s.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(f):n.push(0),void 0!==e.month){var r=t?a(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.push(u+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var c=t?o(e.day):e.day;n.push(c+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var g=p[d];void 0!==e[g]?n.push(e[g]):n.push(0)}return"datetime("+n.join(", ")+")"}var s=e("./util"),l=e("./log"),f=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=u,n.dateTimeExpr=c},{"./log":51,"./util":58}],49:[function(e,t,n){"use strict";function r(e,t){var n=e&&e[t];return!!n&&(f.isArray(n)?f.some(n,function(e){return!!e.field}):s.isFieldDef(n))}function i(e){return f.some(l.CHANNELS,function(t){if(r(e,t)){var n=e[t];return f.isArray(n)?f.some(n,function(e){return!!e.aggregate}):s.isFieldDef(n)&&!!n.aggregate}return!1})}function a(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function o(e){var t=[];return l.CHANNELS.forEach(function(n){if(r(e,n)){var i=e[n];(f.isArray(i)?i:[i]).forEach(function(e){t.push(e)})}}),t}function u(e,t,n){e&&Object.keys(e).forEach(function(r){var i=r;f.isArray(e[i])?e[i].forEach(function(e){t.call(n,e,i)}):t.call(n,e[i],i)})}function c(e,t,n,r){return e?Object.keys(e).reduce(function(n,i){var a=i;return f.isArray(e[a])?e[a].reduce(function(e,n){return t.call(r,e,n,a)},n):t.call(r,n,e[a],a)},n):n}var s=e("./fielddef"),l=e("./channel"),f=e("./util");n.channelHasField=r,n.isAggregate=i,n.isRanged=a,n.fieldDefs=o,n.forEach=u,n.reduce=c},{"./channel":46,"./fielddef":50,"./util":58}],50:[function(e,t,n){"use strict";function r(e){return e&&!!e.field}function i(e){return e&&"value"in e&&void 0!==e.value}function a(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(l(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a="bin",i=t.binSuffix):!t.noAggregate&&e.aggregate?a=String(e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.datum&&(n='datum["'+n+'"]'),n}function o(e){return!!m.contains([E.NOMINAL,E.ORDINAL],e.type)||(!!e.bin||e.type===E.TEMPORAL&&!!e.timeUnit)}function u(e){return e&&r(e)&&o(e)}function c(e){return e&&r(e)&&!o(e)}function s(){return{field:"*",aggregate:g.AggregateOp.COUNT,type:E.QUANTITATIVE}}function l(e){return e.aggregate===g.AggregateOp.COUNT}function f(e,t){if(null!=e.title)return e.title;if(l(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toString().toUpperCase()+"("+e.field+")":e.field}function d(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";var n=y.getSupportedRole(t).measure;return n?"quantitative":"nominal"}function p(e,t){if(e.field){var n=E.getFullName(e.type);if(n)e.type=n;else{var r=d(e,t);h.warn(h.message.emptyOrInvalidFieldType(e.type,t,r)),e.type=r}}return e}var g=e("./aggregate"),y=e("./channel"),h=e("./log"),E=e("./type"),m=e("./util");n.isFieldDef=r,n.isValueDef=i,n.field=a,n.isDimension=u,n.isMeasure=c,n.count=s,n.isCount=l,n.title=f,n.defaultType=d,n.normalize=p},{"./aggregate":43,"./channel":46,"./log":51,"./type":57,"./util":58}],51:[function(e,t,n){"use strict";function r(e){var t=p=new g;e(t),o()}function i(e){return function(){var t=p=new g;e(t),o()}}function a(e){return p=e}function o(){return p=d}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.warn.apply(p,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.info.apply(p,arguments)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.debug.apply(p,arguments)}var l=e("vega-util"),f=e("./channel"),d=l.logger(l.Warn),p=d,g=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=g,n.runLocalLogger=r,n.wrap=i,n.set=a,n.reset=o,n.warn=u,n.info=c,n.debug=s;var y;!function(e){function t(e){return'Invalid field type "'+e+'"'}function n(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function r(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function i(e,t){return e+" dropped as it is incompatible with "+t}function a(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function o(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function u(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function c(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function s(e,t){return"Specified orient "+e+" overridden with "+t}function l(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function d(e){return"rangeStep for "+e+" is dropped as top-level "+(e===f.X?"width":"height")+" is provided."}function p(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function g(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function y(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function h(e){return"Cannot stack "+e+" if there is already "+e+"2"}function E(e){return"Cannot stack non-linear scale ("+e+")"}function m(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function v(e,t){return"Invalid "+e+": "+t}function T(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+(e+"").replace("day","date")+"."}function N(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.DEPRECATED_FILTER_NULL="filterNull is deprecated. Please use filterInvalid instead.",e.invalidFieldType=t,e.emptyOrInvalidFieldType=n,e.emptyFieldDef=r,e.incompatibleChannel=i,e.facetChannelShouldBeDiscrete=a,e.discreteChannelCannotEncode=o,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=u,e.unclearOrientDiscreteOrEmpty=c,e.orientOverridden=s,e.CANNOT_USE_SCHEME_WITH_NON_COLOR="Cannot use scheme with non-color channel.",e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=l,e.rangeStepDropped=d,e.scaleTypeNotWorkWithChannel=p,e.scalePropertyNotWorkWithScaleType=g,e.scaleTypeNotWorkWithMark=y,e.INVAID_DOMAIN="Invalid scale domain",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=h,e.cannotStackNonLinearScale=E,e.cannotStackNonSummativeAggregate=m,e.invalidTimeUnit=v,e.dayReplacedWithDate=T,e.droppedDay=N}(y=n.message||(n.message={}))},{"./channel":46,"vega-util":59}],52:[function(e,t,n){"use strict";var r,i=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square",e.ERRORBAR="errorBar"}(r=n.Mark||(n.Mark={})),n.AREA=r.AREA,n.BAR=r.BAR,n.LINE=r.LINE,n.POINT=r.POINT,n.TEXT=r.TEXT,n.TICK=r.TICK,n.RECT=r.RECT,n.RULE=r.RULE,n.CIRCLE=r.CIRCLE,n.SQUARE=r.SQUARE,n.ERRORBAR=r.ERRORBAR,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RULE,n.CIRCLE,n.SQUARE],n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4682b4",minOpacity:.3,maxOpacity:.8,minStrokeWidth:1,maxStrokeWidth:4},n.defaultAreaConfig={},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultLineConfig={strokeWidth:2},n.defaultSymbolConfig={size:30,minSize:9,strokeWidth:2},n.defaultPointConfig=i.extend({},n.defaultSymbolConfig,{shape:"circle",shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]}),n.defaultCircleConfig=n.defaultSymbolConfig,n.defaultSquareConfig=n.defaultSymbolConfig,n.defaultRectConfig={},n.defaultRuleConfig={strokeWidth:1},n.defaultTextConfig={fontSize:10,minFontSize:8,maxFontSize:40,baseline:"middle",text:"Abc",applyColorToBackground:!1},n.defaultTickConfig={minBandSize:3,thickness:1}},{"./util":58}],53:[function(e,t,n){"use strict";function r(e){return e in g}function i(e){return e in p}function a(e){return e in d}function o(e){return e&&!!e.name}function u(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"round":return a(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return f.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return a(e)||"sequential"===e;case"nice":return a(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return!r(e)&&!f.contains(["log","time","utc"],e);case"useRawDomain":return a(e)||f.contains(["quantize","quantile","threshold"],e)}throw new Error("Invalid scale property "+t+".")}function c(e,t){switch(t){case"range":if("x"===e||"y"===e)return l.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return l.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return l.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return l.message.CANNOT_USE_PADDING_WITH_FACET;return;case"scheme":if("color"!==e)return l.message.CANNOT_USE_SCHEME_WITH_NON_COLOR;return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":case"useRawDomain":return}throw new Error('Invalid scale property "${propName}".')}var s,l=e("./log"),f=e("./util");!function(e){e.LINEAR="linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.POINT="point",e.BAND="band"}(s=n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","log","pow","sqrt","time","utc","sequential","ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","log","pow","sqrt","time","utc"];var d=f.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var p=f.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","point","band"];var g=f.toSet(n.DISCRETE_DOMAIN_SCALES);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=r,n.hasContinuousDomain=i,n.isContinuousToContinuous=a;var y;!function(e){e.SECOND="second",e.MINUTE="minute",e.HOUR="hour",e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year"}(y=n.NiceTime||(n.NiceTime={})),n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,useRawDomain:!1},n.isExtendedScheme=o,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","clamp","nice","exponent","zero","useRawDomain"],n.scaleTypeSupportProperty=u,n.channelScalePropertyIncompatability=c},{"./log":51,"./util":58}],54:[function(e,t,n){"use strict";function r(e){return!!e&&!!e.field&&!!e.op}var i;!function(e){e.ASCENDING="ascending",e.DESCENDING="descending"}(i=n.SortOrder||(n.SortOrder={})),n.isSortField=r},{}],55:[function(e,t,n){"use strict";function r(e,t,r){if(d.contains([i.NONE,null,!1],r))return null;if(!d.contains(n.STACKABLE_MARKS,e))return null;if(!c.isAggregate(t))return null;var l=u.STACK_GROUP_CHANNELS.reduce(function(e,n){if(c.channelHasField(t,n)){var r=t[n];(d.isArray(r)?r:[r]).forEach(function(t){s.isFieldDef(t)&&!t.aggregate&&e.push({channel:n,fieldDef:t})})}return e},[]);if(0===l.length)return null;var p=s.isFieldDef(t.x),g=s.isFieldDef(t.y),y=s.isFieldDef(t.x)&&!!t.x.aggregate,h=s.isFieldDef(t.y)&&!!t.y.aggregate;if(y!==h){var E=y?u.X:u.Y,m=t[E],v=m.aggregate,T=m.scale;return d.contains(n.STACK_BY_DEFAULT_MARKS,e)&&(r=void 0===r?i.ZERO:r),r?T&&T.type&&T.type!==f.ScaleType.LINEAR?(a.warn(a.message.cannotStackNonLinearScale(T.type)),null):c.channelHasField(t,E===u.X?u.X2:u.Y2)?(a.warn(a.message.cannotStackRangedMark(E)),null):d.contains(o.SUM_OPS,v)?{groupbyChannel:y?g?u.Y:null:p?u.X:null,fieldChannel:E,stackBy:l,offset:r}:(a.warn(a.message.cannotStackNonSummativeAggregate(v)),null):null}return null}var i,a=e("./log"),o=e("./aggregate"),u=e("./channel"),c=e("./encoding"),s=e("./fielddef"),l=e("./mark"),f=e("./scale"),d=e("./util");!function(e){e.ZERO="zero",e.CENTER="center",e.NORMALIZE="normalize",e.NONE="none"}(i=n.StackOffset||(n.StackOffset={})),n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=r},{"./aggregate":43,"./channel":46,"./encoding":49,"./fielddef":50,"./log":51,"./mark":52,"./scale":53,"./util":58}],56:[function(e,t,n){"use strict";function r(e){return!!g[e]}function i(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case l.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case l.YEAR:r.setFullYear(t.getFullYear());break;case l.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case l.MONTH:r.setMonth(t.getMonth());break;case l.DATE:r.setDate(t.getDate());break;case l.HOURS:r.setHours(t.getHours());break;case l.MINUTES:r.setMinutes(t.getMinutes());break;case l.SECONDS:r.setSeconds(t.getSeconds());break;case l.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function a(e){return!!y[e]}function o(e,t){var n=e.toString(),r=t.toString(),i=n.indexOf(r);return i>-1&&(t!==l.SECONDS||0===i||"i"!==n.charAt(i-1))}function u(e,t){function r(e){return e===l.QUARTER?"(quarter("+i+")-1)":e+"("+i+")"}var i='datum["'+t+'"]',a=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=r(n)),t},{});return a.day&&d.keys(a).length>1&&(p.warn(p.message.dayReplacedWithDate(e)),delete a.day,a.date=r(l.DATE)),f.dateTimeExpr(a)}function c(e){if(e)return o(e,l.SECONDS)?"second":o(e,l.MINUTES)?"minute":o(e,l.HOURS)?"hour":o(e,l.DAY)||o(e,l.DATE)?"day":o(e,l.MONTH)?"month":o(e,l.YEAR)?"year":void 0}function s(e,t,n){if(e){var r=[],i="",a=o(e,l.YEAR);o(e,l.QUARTER)&&(i="'Q' + quarter("+t+")"),o(e,l.MONTH)&&r.push(n!==!1?"%b":"%B"),
o(e,l.DAY)?r.push(n?"%a":"%A"):o(e,l.DATE)&&r.push("%d"+(a?",":"")),a&&r.push(n?"%y":"%Y");var u=[];o(e,l.HOURS)&&u.push("%H"),o(e,l.MINUTES)&&u.push("%M"),o(e,l.SECONDS)&&u.push("%S"),o(e,l.MILLISECONDS)&&u.push("%L");var c=[];return r.length>0&&c.push(r.join(" ")),u.length>0&&c.push(u.join(":")),c.length>0&&(i&&(i+=" + ' ' + "),i+="timeFormat("+t+", '"+c.join(" ")+"')"),i||void 0}}var l,f=e("./datetime"),d=e("./util"),p=e("./log");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(l=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[l.YEAR,l.QUARTER,l.MONTH,l.DAY,l.DATE,l.HOURS,l.MINUTES,l.SECONDS,l.MILLISECONDS];var g=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=i,n.MULTI_TIMEUNITS=[l.YEARQUARTER,l.YEARQUARTERMONTH,l.YEARMONTH,l.YEARMONTHDATE,l.YEARMONTHDATEHOURS,l.YEARMONTHDATEHOURSMINUTES,l.YEARMONTHDATEHOURSMINUTESSECONDS,l.QUARTERMONTH,l.HOURSMINUTES,l.HOURSMINUTESSECONDS,l.MINUTESSECONDS,l.SECONDSMILLISECONDS];var y=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=a,n.TIMEUNITS=[l.YEAR,l.QUARTER,l.MONTH,l.DAY,l.DATE,l.HOURS,l.MINUTES,l.SECONDS,l.MILLISECONDS,l.YEARQUARTER,l.YEARQUARTERMONTH,l.YEARMONTH,l.YEARMONTHDATE,l.YEARMONTHDATEHOURS,l.YEARMONTHDATEHOURSMINUTES,l.YEARMONTHDATEHOURSMINUTESSECONDS,l.QUARTERMONTH,l.HOURSMINUTES,l.HOURSMINUTESSECONDS,l.MINUTESSECONDS,l.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=u,n.smallestUnit=c,n.formatExpression=s},{"./datetime":48,"./log":51,"./util":58}],57:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={})),n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=r},{}],58:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=m(e);return t.forEach(function(e){delete n[e]}),n}function a(e){return A.isString(e)||A.isNumber(e)||v(e)?String(e):T(e)}function o(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!o(t,e)})}function c(e,t){return e.concat(u(t,e))}function s(e,t,n,r){if(e.reduce)return e.reduce.call(r,t,n);for(var i in e)e.hasOwnProperty(i)&&(n=t.call(r,n,e[i],i,e));return n}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function f(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function d(e){return[].concat.apply([],e)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];e=g(e,a)}return e}function g(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=p(t[n].constructor===Array?[]:{},t[n]):p(e[n],t[n]));return e}function y(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var u=o[a];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function E(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function m(e){return JSON.parse(JSON.stringify(e))}function v(e){return e===!0||e===!1}var T=e("json-stable-stringify"),N=e("vega-util");n.extend=N.extend,n.isArray=N.isArray,n.isObject=N.isObject,n.isNumber=N.isNumber,n.isString=N.isString,n.truncate=N.truncate,n.toSet=N.toSet;var A=e("vega-util");n.pick=r,n.omit=i,n.hash=a,n.contains=o,n.without=u,n.union=c,n.reduce=s,n.some=l,n.every=f,n.flatten=d,n.mergeDeep=p,n.unique=y,n.differ=h,n.keys=Object.keys,n.vals=E,n.duplicate=m,n.isBoolean=v},{"json-stable-stringify":39,"vega-util":59}],59:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return c(e)?"["+e.map(r)+"]":s(e)||l(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},u=function(e){function t(){a.push(l+e.substring(n,r)),l="",n=r+1}var n,r,i,a=[],u=null,c=0,s=e.length,l="";for(e+="",n=r=0;r<s;++r)if(i=e[r],"\\"===i)l+=e.substring(n,r),n=++r;else if(i===u)t(),u=null,c=-1;else{if(u)continue;n===c&&'"'===i?(n=r+1,u=i):n===c&&"'"===i?(n=r+1,u=i):"."!==i||c?"["===i?(r>n&&t(),c=n=r+1):"]"===i&&(c||o("Access path missing open bracket: "+e),c>0&&t(),c=0,n=r+1):r>n?t():n=r+1}return c&&o("Access path missing closing bracket: "+e),u&&o("Access path missing closing quote: "+e),r>n&&(++r,t()),a},c=Array.isArray,s=function(e){return e===Object(e)},l=function(e){return"string"==typeof e},f=function(e,t){var n=u(e),i="return _["+n.map(r).join("][")+"];";return a(Function("_",i),[e=1===n.length?n[0]:e],t||e)},d=[],p=f("id"),g=a(function(e){return e},d,"identity"),y=a(function(){return 0},d,"zero"),h=a(function(){return 1},d,"one"),E=a(function(){return!0},d,"true"),m=a(function(){return!1},d,"false"),v=0,T=1,N=2,A=3,S=function(e){var t=e||v;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=T&&i("warn","WARN",arguments),this},info:function(){return t>=N&&i("log","INFO",arguments),this},debug:function(){return t>=A&&i("log","DEBUG",arguments),this}}},C=function(e){return null!=e?c(e)?e:[e]:[]},O=function(e,t){if(null==e)return null;e=C(e);var n,i,o,c,s,l,f,d=e.map(function(e){return u(e).map(r).join("][")}),p=C(t),g=d.length-1,y="var u,v;return ";for(n=0;n<=g;++n)i=d[n],o="(u=a["+i+"])",c="(v=b["+i+"])",s="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",l="descending"!==p[n]?(f=1,-1):(f=-1,1),y+="("+o+"<"+c+"||u==null)&&v!=null?"+l+":(u>v||v==null)&&u!=null?"+f+":"+s+"!==u&&v===v?"+l+":v!==v&&u===u?"+f+(n<g?":":":0");return a(Function("a","b",y+";"),e)},I=function(e){return"function"==typeof e},P=function(e){return I(e)?e:function(){return e}},R=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},M=function(e,t){var n,r,i,a,o,u=-1,c=e.length;if(null==t){for(;++u<c;)if(null!=(r=e[u])&&r>=r){n=i=r;break}for(a=o=u;++u<c;)null!=(r=e[u])&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}else{for(;++u<c;)if(null!=(r=t(e[u],u,e))&&r>=r){n=i=r;break}for(a=o=u;++u<c;)null!=(r=t(e[u],u,e))&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}return[a,o]},D={},U=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==D}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===D&&--n.empty),i[e]=r,this},"delete":function(e){return t(e)&&(--n.size,++n.empty,i[e]=D),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,a={},o=0;for(e in i)t=i[e],t===D||r&&r(t)||(a[e]=t,++o);n.size=o,n.empty=0,n.object=i=a}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},_=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},L=function(e){return"number"==typeof e},b=function(e){e=e?C(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+u(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},w=function(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),u=0,c=0,s=0;u<i&&c<a;++s)o[s]=e(t[u],n[c])>0?n[c++]:t[u++];for(;u<i;++u,++s)o[s]=t[u];for(;c<a;++c,++s)o[s]=n[c];return o},x=function(e,t){for(var n="";--t>=0;)n+=e;return n},k=function(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?x(i,o)+a:"center"===r?x(i,~~(o/2))+a+x(i,Math.ceil(o/2)):a+x(i,o)},F=function(e){return e[e.length-1]},H=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},G=function(e,t,n,r){var i=null!=r?r:"…",a=e+"",o=a.length,u=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-u):"center"===n?a.slice(0,Math.ceil(u/2))+i+a.slice(o-~~(u/2)):a.slice(0,u)+i},W=function(e,t,n){if(e){var r,i=0,a=e.length;if(t)for(;i<a;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=a,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=g,e.zero=y,e.one=h,e.truthy=E,e.falsy=m,e.logger=S,e.None=v,e.Warn=T,e.Info=N,e.Debug=A,e.array=C,e.compare=O,e.constant=P,e.error=o,e.extend=R,e.extentIndex=M,e.fastmap=U,e.field=f,e.inherits=_,e.isArray=c,e.isFunction=I,e.isNumber=L,e.isObject=s,e.isString=l,e.key=b,e.merge=w,e.pad=k,e.peek=F,e.repeat=x,e.splitAccessPath=u,e.stringValue=r,e.toSet=H,e.truncate=G,e.visitArray=W,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[6])(6)});
//# sourceMappingURL=build/compassql.min.js.map
